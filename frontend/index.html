<!DOCTYPE html>
<!-- Estructura b√°sica de un documento HTML para el juego de b√©isbol tiradados -->
<html lang="es">

<head>
    <meta charset="UTF-8">
    <!-- Hace que el dise√±o sea adaptable en m√≥viles -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öæ DEADball ULTRAMEGA</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <!-- Enlace a los estilos CSS personalizados -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Bot\u00f3n para volver al men\u00fa -->
    <button onclick="window.location.href='menu.html'" style="position: fixed; top: 10px; left: 10px; z-index: 9999; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: #0f172a; border: none; padding: 0.5rem 1rem; border-radius: 8px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3); transition: all 0.3s ease;">
        \u2190 Men\u00fa Principal
    </button>

    <!-- Contenedor principal del juego -->
    <div id="app">
        <!-- Contenedor del marcador arriba -->
        <div class="marcador-container">
            <div class="marcador-wrapper">
                <table class="marcador-table">
                    <thead>
                        <tr>
                            <th>Equipo</th>
                            <th>1</th>
                            <th>2</th>
                            <th>3</th>
                            <th>4</th>
                            <th>5</th>
                            <th>6</th>
                            <th>7</th>
                            <th>8</th>
                            <th>9</th>
                            <th>R</th>
                            <th>H</th>
                            <th>E</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="team-name">Visitante</td>
                            <td class="inning-score">0</td>
                            <td class="inning-score">0</td>
                            <td class="inning-score">0</td>
                            <td class="inning-score">0</td>
                            <td class="inning-score">0</td>
                            <td class="inning-score">0</td>
                            <td class="inning-score">0</td>
                            <td class="inning-score">0</td>
                            <td class="inning-score">0</td>
                            <td class="total-runs">0</td>
                            <td class="total-hits">0</td>
                            <td class="total-errors">0</td>
                        </tr>
                        <tr>
                            <td class="team-name">Local</td>
                            <td class="inning-score">0</td>
                            <td class="inning-score">0</td>
                            <td class="inning-score">0</td>
                            <td class="inning-score">0</td>
                            <td class="inning-score">0</td>
                            <td class="inning-score">0</td>
                            <td class="inning-score">0</td>
                            <td class="inning-score">0</td>
                            <td class="inning-score">0</td>
                            <td class="total-runs">0</td>
                            <td class="total-hits">0</td>
                            <td class="total-errors">0</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="marcador-button-container">
                <!-- Bot√≥n de Reiniciar -->
                <button class="save-game-btn" onclick="confirmResetGame()" title="Reiniciar partido (mantiene equipos y fotos)" style="background: #ef4444;">
                            üîÑ Reiniciar
                        </button>
                <!-- Botones de Guardar/Cargar Partida -->
                <button class="save-game-btn" onclick="guardarPartida()" title="Guardar partida actual">
                            üíæ Guardar
                        </button>
                <button class="load-game-btn" onclick="mostrarPartidas()" title="Cargar partida guardada">
                            üìÇ Cargar
                        </button>
                <!-- Bot√≥n de Chat -->
                <button class="save-game-btn" onclick="toggleChat()" title="Abrir chat" style="background: #667eea;">
                            üí¨ Chat
                        </button>
                <!-- Bot√≥n de Hall of Fame -->
                <button class="save-game-btn" onclick="toggleHall()" title="Ver ranking" style="background: #fbbf24;">
                            üèÜ Hall
                        </button>
                <!-- Bot√≥n de Audio -->
                <button class="save-game-btn" onclick="toggleAudioModal()" title="Controles de audio" style="background: #8b5cf6;">
                            üéµ Audio
                        </button>
                <!-- Bot√≥n de Logout -->
                <button class="save-game-btn" onclick="logout()" title="Cerrar sesi√≥n" style="background: #ef4444;">
                            üö™ Salir
                        </button>
            </div>
        </div>

        <!-- Estructura de dos columnas laterales para los equipos -->
        <div class="dashboard">
            <!-- Columna izquierda: Equipo visitante -->
            <div class="col col-visitante">
                <div class="team-header">
                    <h2 id="header-title-visitante">üõ´ Equipo Visitante</h2>
                    <div id="team-name-visitante" style="font-size: 24px; font-weight: 800; margin-top: -8px; margin-bottom: 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 0 2px 4px rgba(0,0,0,0.1);"></div>
                    <button class="config-btn" onclick="openTeamConfig('visitante')">‚öôÔ∏è</button>
                </div>

                <!-- Tabla de roster del equipo visitante -->
                <div class="roster-container">
                    <table class="roster-table" id="roster-visitante">
                        <thead>
                            <tr>
                                <th>Handle</th>
                                <th>#</th>
                                <th>Foto</th>
                                <th>Nombre</th>
                                <th>Posici√≥n</th>
                                <th>Mano</th>
                                <th>AVG</th>
                                <th>OBP</th>
                                <th>Traits</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="player-row" draggable="true" data-player-id="1">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">1</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador 1</td>
                                <td>
                                    <select class="position-select" data-player="1">
                                        <option value="P" selected>P</option>
                                        <option value="C">C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="1">
                                        <option value="R" selected>R</option>
                                        <option value="L">L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.285</td>
                                <td class="on-base-pct">.340</td>
                                <td>
                                    <select class="trait-select" data-player="1">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">‚öæ</td>
                            </tr>
                            <tr class="player-row" draggable="true" data-player-id="2">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">2</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador 2</td>
                                <td>
                                    <select class="position-select" data-player="2">
                                        <option value="P">P</option>
                                        <option value="C" selected>C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="2">
                                        <option value="R" selected>R</option>
                                        <option value="L">L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.275</td>
                                <td class="on-base-pct">.330</td>
                                <td>
                                    <select class="trait-select" data-player="2">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">-</td>
                            </tr>
                            <tr class="player-row" draggable="true" data-player-id="3">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">3</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador 3</td>
                                <td>
                                    <select class="position-select" data-player="3">
                                        <option value="P">P</option>
                                        <option value="C">C</option>
                                        <option value="1B" selected>1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="3">
                                        <option value="R">R</option>
                                        <option value="L" selected>L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.310</td>
                                <td class="on-base-pct">.380</td>
                                <td>
                                    <select class="trait-select" data-player="3">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">-</td>
                            </tr>
                            <tr class="player-row" draggable="true" data-player-id="4">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">4</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador 4</td>
                                <td>
                                    <select class="position-select" data-player="4">
                                        <option value="P">P</option>
                                        <option value="C">C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B" selected>2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="4">
                                        <option value="R" selected>R</option>
                                        <option value="L">L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.265</td>
                                <td class="on-base-pct">.315</td>
                                <td>
                                    <select class="trait-select" data-player="4">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">-</td>
                            </tr>
                            <tr class="player-row" draggable="true" data-player-id="5">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">5</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador 5</td>
                                <td>
                                    <select class="position-select" data-player="5">
                                        <option value="P">P</option>
                                        <option value="C">C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B" selected>3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="5">
                                        <option value="R" selected>R</option>
                                        <option value="L">L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.290</td>
                                <td class="on-base-pct">.350</td>
                                <td>
                                    <select class="trait-select" data-player="5">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">-</td>
                            </tr>
                            <tr class="player-row" draggable="true" data-player-id="6">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">6</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador 6</td>
                                <td>
                                    <select class="position-select" data-player="6">
                                        <option value="P">P</option>
                                        <option value="C">C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS" selected>SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="6">
                                        <option value="R">R</option>
                                        <option value="L" selected>L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.255</td>
                                <td class="on-base-pct">.310</td>
                                <td>
                                    <select class="trait-select" data-player="6">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">-</td>
                            </tr>
                            <tr class="player-row" draggable="true" data-player-id="7">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">7</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador 7</td>
                                <td>
                                    <select class="position-select" data-player="7">
                                        <option value="P">P</option>
                                        <option value="C">C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF" selected>LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="7">
                                        <option value="R">R</option>
                                        <option value="L" selected>L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.280</td>
                                <td class="on-base-pct">.340</td>
                                <td>
                                    <select class="trait-select" data-player="7">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">-</td>
                            </tr>
                            <tr class="player-row" draggable="true" data-player-id="8">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">8</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador 8</td>
                                <td>
                                    <select class="position-select" data-player="8">
                                        <option value="P">P</option>
                                        <option value="C">C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF" selected>CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="8">
                                        <option value="R" selected>R</option>
                                        <option value="L">L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.295</td>
                                <td class="on-base-pct">.360</td>
                                <td>
                                    <select class="trait-select" data-player="8">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">-</td>
                            </tr>
                            <tr class="player-row" draggable="true" data-player-id="9">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">9</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador 9</td>
                                <td>
                                    <select class="position-select" data-player="9">
                                        <option value="P">P</option>
                                        <option value="C">C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF" selected>RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="9">
                                        <option value="R" selected>R</option>
                                        <option value="L">L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.270</td>
                                <td class="on-base-pct">.325</td>
                                <td>
                                    <select class="trait-select" data-player="9">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- BANQUILLO EQUIPO VISITANTE -->
                <div class="bench-container" id="bench-visitante" style="margin-top: 1rem; background: rgba(30,30,50,0.5); border-radius: 8px; padding: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <h4 style="color: #fbbf24; margin: 0; font-size: 1rem;">ü™ë Banquillo</h4>
                        <div>
                            <button onclick="toggleBench('visitante')" style="background: #374151; color: white; border: none; padding: 0.3rem 0.8rem; border-radius: 4px; cursor: pointer; margin-right: 0.5rem;">üëÅÔ∏è</button>
                            <button onclick="addBenchPlayer('visitante')" style="background: #059669; color: white; border: none; padding: 0.3rem 0.8rem; border-radius: 4px; cursor: pointer; font-weight: bold;">+ A√±adir</button>
                        </div>
                    </div>
                    <table class="roster-table bench-table" id="bench-table-visitante" style="font-size: 0.85rem;">
                        <thead>
                            <tr>
                                <th>Handle</th>
                                <th>#</th>
                                <th>Foto</th>
                                <th>Nombre</th>
                                <th>Posici√≥n</th>
                                <th>Mano</th>
                                <th>AVG</th>
                                <th>OBP</th>
                                <th>Traits</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="player-row" draggable="true" data-player-id="10">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">10</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador 10</td>
                                <td>
                                    <select class="position-select" data-player="10">
                                        <option value="P">P</option>
                                        <option value="C">C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH" selected>DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="10">
                                        <option value="R">R</option>
                                        <option value="L" selected>L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.305</td>
                                <td class="on-base-pct">.375</td>
                                <td>
                                    <select class="trait-select" data-player="10">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">ü™ë</td>
                            </tr>
                            <tr class="player-row" draggable="true" data-player-id="11">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">11</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Pitcher Alt</td>
                                <td>
                                    <select class="position-select" data-player="11">
                                        <option value="P" selected>P</option>
                                        <option value="C">C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="11">
                                        <option value="R" selected>R</option>
                                        <option value="L">L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.180</td>
                                <td class="on-base-pct">.220</td>
                                <td>
                                    <select class="trait-select" data-player="11">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">ü™ë</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- CONTENEDOR DE DADOS CON OVERLAY DE INTENCIONES -->
                <div class="dice-layers-container" style="position: relative; min-height: 400px;">
                    <!-- CAPA SUPERIOR: SELECTOR DE INTENCIONES DEL BATEADOR (OVERLAY) -->
                    <div id="intention-container-visitante" class="dynamic-dice-container intention-selector card shadow-lg mb-4" style="display: block; opacity: 1;">
                        <div class="card-body">
                            <div class="text-center mb-3">
                                <h5 class="card-title text-white mb-1">
                                    <i class="fas fa-bullseye me-2"></i>üéØ ¬øCu√°l es tu intenci√≥n?
                                </h5>
                                <p class="card-text text-white-50 mb-0">Selecciona la estrategia del bateador</p>
                            </div>
                            <div class="row g-3">
                                <div class="col-6">
                                    <button class="btn intention-btn normal-hit w-100 py-3" onclick="selectIntention('normal')" id="intention-normal">
                                        <div class="d-flex flex-column align-items-center">
                                            <span class="fs-4 mb-1">‚öæ</span>
                                            <span class="fw-bold">Batear Normal</span>
                                        </div>
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button class="btn intention-btn steal-base w-100 py-3" onclick="selectIntention('steal')" id="intention-steal">
                                        <div class="d-flex flex-column align-items-center">
                                            <span class="fs-4 mb-1">üèÉ‚Äç‚ôÇÔ∏è</span>
                                            <span class="fw-bold">Robar Base</span>
                                        </div>
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button class="btn intention-btn bunt w-100 py-3" onclick="selectIntention('bunt')" id="intention-bunt">
                                        <div class="d-flex flex-column align-items-center">
                                            <span class="fs-4 mb-1">ü§è</span>
                                            <span class="fw-bold">Toque/Bunt</span>
                                        </div>
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button class="btn intention-btn hit-run w-100 py-3" onclick="selectIntention('hitrun')" id="intention-hitrun">
                                        <div class="d-flex flex-column align-items-center">
                                            <span class="fs-4 mb-1">‚ö°</span>
                                            <span class="fw-bold">Hit & Run</span>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CAPA INFERIOR: Contenedor din√°mico para sistema de dados -->
                    <div id="dice-container-visitante" class="dynamic-dice-container" style="display: none;">
                        <div class="dice-system">
                            <div class="dice-action-area">
                                <div class="dice-action-header">
                                    <div class="current-batter-info" id="current-batter-info">
                                        <span class="batter-name">Bateador Actual</span>
                                        <span class="batter-stats">AVG: .000</span>
                                    </div>
                                    <div class="result-confirmation" id="result-confirmation" style="display: none;">
                                        <button class="confirm-result-btn" onclick="confirmResult('visitante')" id="confirm-btn">
                                        ‚úì Confirmar
                                    </button>
                                    </div>
                                </div>
                                <div class="pitch-die-display">
                                    <span class="pitch-die-label">Pitch Die:</span>
                                    <span class="pitch-die-value" id="pitch-die-local">d12</span>
                                </div>
                                <div class="dice-controls">
                                    <!-- Dados visuales lado a lado -->
                                    <div class="dice-display">
                                        <div class="dice-item">
                                            <div class="dice-label">LANZADOR</div>
                                            <div class="dice-visual" id="pitcher-dice">
                                                <select class="dice-type-selector" id="pitcher-dice-type" onchange="updatePitcherDiceRange('visitante')">
                                                <option value="20">D20</option>
                                                <option value="12" selected>D12</option>
                                                <option value="8">D8</option>
                                                <option value="4">D4</option>
                                                <option value="-4">-D4</option>
                                                <option value="-8">-D8</option>
                                                <option value="-12">-D12</option>
                                                <option value="-20">-D20</option>
                                            </select>
                                                <input type="number" class="dice-value-input" id="pitcher-dice-value" placeholder="-" min="-20" max="20">
                                                <div class="mini-dice" onclick="rollPitcherDice('visitante')" title="Tirar dado del lanzador">üé≤</div>
                                            </div>
                                        </div>
                                        <div class="dice-operator">+</div>
                                        <div class="dice-item">
                                            <div class="dice-label">BATEADOR</div>
                                            <div class="dice-visual" id="batter-dice">
                                                <span class="dice-type">D100</span>
                                                <input type="number" class="dice-value-input" id="batter-dice-value" placeholder="-" min="1" max="100">
                                                <div class="mini-dice" onclick="rollBatterDice('visitante')" title="Tirar dado del bateador">üé≤</div>
                                            </div>
                                        </div>
                                        <div class="dice-operator">=</div>
                                        <div class="dice-item result">
                                            <div class="dice-label">RESULTADO</div>
                                            <div class="dice-visual result" id="total-result">
                                                <span class="dice-value" id="final-result">-</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="result-section">
                                        <div class="result-description" id="result-description">
                                            Esperando tirada...
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- Cierre del dice-layers-container -->
            </div>
            <!-- Fin columna visitante -->

            <!-- Columna central: terreno de juego y sistema de dados -->
            <div class="col col-central">

                <!-- Bot√≥n de iniciar juego encima del estadio -->

                <!-- SWING RESULT TABLE -->
                <div id="swing-result-table-container" class="result-table-inline" style="display: none; margin-bottom: 20px; animation: slideDown 0.3s ease-out;">
                    <div class="card shadow-lg" style="border: 2px solid #fbbf24;">
                        <div class="card-body">
                            <h5 class="card-title text-center text-white mb-3">
                                <span id="batter-name-display" class="text-warning">--</span><small class="text-warning"> (BT:<span id="bt-value">--</span> | OBT:<span id="obt-value">--</span>)</small> <span class="text-dark">- SWING RESULT TABLE</span>
                            </h5>
                            <table class="table table-dark table-striped table-bordered">
                                <thead>
                                    <tr>
                                        <th>MSS</th>
                                        <th>Event</th>
                                        <th>Result</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-mss="1" data-result="oddity">
                                        <td><strong>1</strong></td>
                                        <td><strong>Oddity</strong></td>
                                        <td>Roll 2d10 on Oddities Table.</td>
                                    </tr>
                                    <tr data-mss="2-5" data-result="criticalhit">
                                        <td><strong>2-5</strong></td>
                                        <td><strong>Critical Hit</strong></td>
                                        <td>Roll d20 on Hit Table. Increase hit by one level‚Äîsingle to double, etc. double to triple, etc.</td>
                                    </tr>
                                    <tr data-mss="6-BT" data-result="ordinaryhit">
                                        <td><strong>6-BT</strong></td>
                                        <td><strong>Ordinary Hit</strong></td>
                                        <td>Roll d20 on Hit Table.</td>
                                    </tr>
                                    <tr data-mss="BT+1-OBT" data-result="walk">
                                        <td><strong>BT+1-OBT</strong></td>
                                        <td><strong>Walk</strong></td>
                                        <td>Batter advances to first.</td>
                                    </tr>
                                    <tr data-mss="OBT+1-OBT+5" data-result="possibleerror">
                                        <td><strong>OBT+1-OBT+5</strong></td>
                                        <td><strong>Possible Error</strong></td>
                                        <td>Roll d12 on Defense Table for fielder making the play.</td>
                                    </tr>
                                    <tr data-mss="OBT+6-49" data-result="productiveout1">
                                        <td><strong>OBT+6-49</strong></td>
                                        <td><strong>Productive Out</strong></td>
                                        <td>On a ball in the outfield or to the right of the infield, runners at second and third advance. On a ball anywhere in the infield, a runner at first advances to second and the batter is out.</td>
                                    </tr>
                                    <tr data-mss="50-69" data-result="productiveout2">
                                        <td><strong>50-69</strong></td>
                                        <td><strong>Productive Out</strong></td>
                                        <td>On a ball in outfield or to the right of infield, runners at second and third score. On a ball anywhere in the infield, a runner at first is out and the batter is safe at first on a fielder's choice.</td>
                                    </tr>
                                    <tr data-mss="70+" data-result="out">
                                        <td><strong>70+</strong></td>
                                        <td><strong>Out</strong></td>
                                        <td>Runners at second and third advance on fly ball. On a ball anywhere in the infield, both the runner at first and the batter are out.</td>
                                    </tr>
                                    <tr data-mss="99" data-result="oddity99">
                                        <td><strong>99</strong></td>
                                        <td><strong>Oddity</strong></td>
                                        <td>Roll 2d10 on Oddities Table.</td>
                                    </tr>
                                    <tr data-mss="100+" data-result="out100">
                                        <td><strong>100+</strong></td>
                                        <td><strong>Out</strong></td>
                                        <td>Runners cannot advance on fly ball. Possible triple play.</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="text-center mt-3">
                                <button class="btn btn-success" onclick="closeSwingResultTable()">‚úì Continuar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- HIT TABLE (D20) -->
                <div id="hit-table-container" class="result-table-inline" style="display: none; margin-bottom: 20px; animation: slideDown 0.3s ease-out;">
                    <div class="card shadow-lg" style="border: 2px solid #10b981;">
                        <div class="card-body">
                            <h5 class="card-title text-center text-white mb-3">
                                ‚öæ HIT TABLE (D20)
                            </h5>

                            <div class="dice-display mb-4" style="justify-content: center;">
                                <div class="dice-item">
                                    <div class="dice-label">D20</div>
                                    <div class="dice-visual">
                                        <span class="dice-type">D20</span>
                                        <input type="number" class="dice-value-input" id="hit-d20-value" placeholder="-" min="1" max="20" readonly>
                                        <div class="mini-dice" onclick="rollHitD20()" title="Tirar D20">üé≤</div>
                                    </div>
                                </div>
                            </div>

                            <table class="table table-dark table-striped table-bordered table-sm">
                                <thead>
                                    <tr>
                                        <th style="width: 20%;">Roll</th>
                                        <th style="width: 40%;">Result</th>
                                        <th style="width: 40%;">You Write</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-hit="1-2">
                                        <td><strong>1-2</strong></td>
                                        <td>Single</td>
                                        <td></td>
                                    </tr>
                                    <tr data-hit="3">
                                        <td><strong>3</strong></td>
                                        <td>Single, DEF (1B)</td>
                                        <td></td>
                                    </tr>
                                    <tr data-hit="4">
                                        <td><strong>4</strong></td>
                                        <td>Single, DEF (2B)</td>
                                        <td></td>
                                    </tr>
                                    <tr data-hit="5">
                                        <td><strong>5</strong></td>
                                        <td>Single, DEF (3B)</td>
                                        <td></td>
                                    </tr>
                                    <tr data-hit="6">
                                        <td><strong>6</strong></td>
                                        <td>Single, DEF (SS)</td>
                                        <td></td>
                                    </tr>
                                    <tr data-hit="7-9">
                                        <td><strong>7-9</strong></td>
                                        <td>Single</td>
                                        <td></td>
                                    </tr>
                                    <tr data-hit="10-14">
                                        <td><strong>10-14</strong></td>
                                        <td>Single, runners adv. 2</td>
                                        <td></td>
                                    </tr>
                                    <tr data-hit="15">
                                        <td><strong>15</strong></td>
                                        <td>Double, DEF (LF)</td>
                                        <td></td>
                                    </tr>
                                    <tr data-hit="16">
                                        <td><strong>16</strong></td>
                                        <td>Double, DEF (CF)</td>
                                        <td></td>
                                    </tr>
                                    <tr data-hit="17">
                                        <td><strong>17</strong></td>
                                        <td>Double, DEF (RF)</td>
                                        <td></td>
                                    </tr>
                                    <tr data-hit="18">
                                        <td><strong>18</strong></td>
                                        <td>Double, runners adv. 3</td>
                                        <td></td>
                                    </tr>
                                    <tr data-hit="19-20">
                                        <td><strong>19-20</strong></td>
                                        <td>Home Run</td>
                                        <td></td>
                                    </tr>
                                </tbody>
                            </table>

                            <div id="hit-result-display" class="text-center mb-3" style="display: none; padding: 10px; background: rgba(16, 185, 129, 0.2); border-radius: 6px; color: white; font-size: 1.1rem;">
                            </div>

                            <div class="text-center mt-3">
                                <button class="btn btn-success" onclick="closeHitTable()" id="hit-continue-btn" style="display: none;">‚úì Continuar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DEFENSE TABLE (D12) -->
                <div id="defense-table-container" class="result-table-inline" style="display: none; margin-bottom: 20px; animation: slideDown 0.3s ease-out;">
                    <div class="card shadow-lg" style="border: 2px solid #f59e0b;">
                        <div class="card-body">
                            <h5 class="card-title text-center text-white mb-3">
                                üõ°Ô∏è DEFENSE TABLE (D12) - <span id="defense-position-label">Position</span>
                            </h5>

                            <div class="dice-display mb-4" style="justify-content: center;">
                                <div class="dice-item">
                                    <div class="dice-label">D12</div>
                                    <div class="dice-visual">
                                        <span class="dice-type">D12</span>
                                        <input type="number" class="dice-value-input" id="defense-d12-value" placeholder="-" min="1" max="12" readonly>
                                        <div class="mini-dice" onclick="rollDefenseD12()" title="Tirar D12">üé≤</div>
                                    </div>
                                </div>
                            </div>

                            <table class="table table-dark table-striped table-bordered table-sm">
                                <thead>
                                    <tr>
                                        <th style="width: 20%;">Roll</th>
                                        <th style="width: 80%;">Result</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-defense="1-2">
                                        <td><strong>1-2</strong></td>
                                        <td>Error. Runners take an extra base.</td>
                                    </tr>
                                    <tr data-defense="3-9">
                                        <td><strong>3-9</strong></td>
                                        <td>No change</td>
                                    </tr>
                                    <tr data-defense="10-11">
                                        <td><strong>10-11</strong></td>
                                        <td>Double turns into a single, runners advance 2.</td>
                                    </tr>
                                    <tr data-defense="12">
                                        <td><strong>12</strong></td>
                                        <td>Hit turned into out. Runners hold.</td>
                                    </tr>
                                </tbody>
                            </table>

                            <div id="defense-result-display" class="text-center mb-3" style="display: none; padding: 10px; background: rgba(245, 158, 11, 0.2); border-radius: 6px; color: white; font-size: 1.1rem;">
                            </div>

                            <div class="text-center mt-3">
                                <button class="btn btn-success" onclick="closeDefenseTable()" id="defense-continue-btn" style="display: none;">‚úì Continuar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- OUT TABLE (Referencia para posici√≥n defensiva) -->
                <div id="out-table-container" class="result-table-inline" style="display: none; margin-bottom: 20px; animation: slideDown 0.3s ease-out;">
                    <div class="card shadow-lg" style="border: 2px solid #ef4444;">
                        <div class="card-body">
                            <h5 class="card-title text-center text-white mb-3">
                                üö´ OUT TABLE - √öltimo d√≠gito MSS: <span id="out-last-digit">-</span>
                            </h5>

                            <table class="table table-dark table-striped table-bordered table-sm">
                                <thead>
                                    <tr>
                                        <th style="width: 25%;">Last Digit</th>
                                        <th style="width: 40%;">Result</th>
                                        <th style="width: 35%;">You Write</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-out="0">
                                        <td><strong>0</strong></td>
                                        <td>Strikeout</td>
                                        <td>(K)</td>
                                    </tr>
                                    <tr data-out="1">
                                        <td><strong>1</strong></td>
                                        <td>Strikeout</td>
                                        <td>(K)</td>
                                    </tr>
                                    <tr data-out="2">
                                        <td><strong>2</strong></td>
                                        <td>Strikeout</td>
                                        <td>(K)</td>
                                    </tr>
                                    <tr data-out="3">
                                        <td><strong>3</strong></td>
                                        <td>Groundball to 1B</td>
                                        <td>(G-3)</td>
                                    </tr>
                                    <tr data-out="4">
                                        <td><strong>4</strong></td>
                                        <td>Groundball to 2B</td>
                                        <td>(4-3)</td>
                                    </tr>
                                    <tr data-out="5">
                                        <td><strong>5</strong></td>
                                        <td>Groundball to 3B</td>
                                        <td>(5-3)</td>
                                    </tr>
                                    <tr data-out="6">
                                        <td><strong>6</strong></td>
                                        <td>Groundball to SS</td>
                                        <td>(6-3)</td>
                                    </tr>
                                    <tr data-out="7">
                                        <td><strong>7</strong></td>
                                        <td>Pop-up to LF</td>
                                        <td>(F-7)</td>
                                    </tr>
                                    <tr data-out="8">
                                        <td><strong>8</strong></td>
                                        <td>Pop-up to CF</td>
                                        <td>(F-8)</td>
                                    </tr>
                                    <tr data-out="9">
                                        <td><strong>9</strong></td>
                                        <td>Pop-up to RF</td>
                                        <td>(F-9)</td>
                                    </tr>
                                </tbody>
                            </table>

                            <div id="out-result-display" class="text-center mb-3" style="display: none; padding: 10px; background: rgba(239, 68, 68, 0.2); border-radius: 6px; color: white; font-size: 1.1rem;">
                            </div>

                            <div class="text-center mt-3">
                                <button class="btn btn-danger" onclick="closeOutTable()" id="out-continue-btn" style="display: none;">‚úì Continuar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bot√≥n principal de control (centro) -->
                <div class="start-game-container">
                    <button id="start-game-btn" class="start-game-btn" onclick="startNewGame()">
                        üéÆ Iniciar Nuevo Juego
                    </button>
                </div>
                <!-- ===== SISTEMA DE TOKENS VISUALES EN EL DIAMANTE ===== -->
                <!-- 
                    PROP√ìSITO: Mostrar visualmente los corredores en las bases sobre el diamante
                    FUNCIONALIDAD: Tokens se mueven con animaciones entre bases seg√∫n las jugadas
                    INTEGRACI√ìN: Sincronizado con gameState.bases para mostrar estado actual
                    RESPONSIVE: Se adapta al tama√±o de la imagen del estadio
                -->
                <div class="diamond-container">
                    <img src="imagenes/zelaia.jpg" alt="Terreno de juego de b√©isbol" class="terreno-img">

                    <!-- Capa superpuesta para tokens de corredores -->
                    <div class="diamond-tokens-layer">
                        <!-- Posiciones fijas de las bases para referencia -->
                        <div class="base-marker" data-base="home" title="Home Plate"></div>
                        <div class="base-marker" data-base="first" title="Primera Base"></div>
                        <div class="base-marker" data-base="second" title="Segunda Base"></div>
                        <div class="base-marker" data-base="third" title="Tercera Base"></div>

                        <!-- Los tokens de corredores se a√±adir√°n din√°micamente aqu√≠ -->
                        <div id="runners-container" class="runners-container">
                            <!-- Los tokens de jugadores aparecer√°n aqu√≠ mediante JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- √ÅREA DE RESOLUCI√ìN DE JUGADAS - Ocupa todo el espacio azul -->
                <div id="plays-resolution-area" style="
                    width: 100%;
                    max-height: 400px;
                    background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #1e3a8a 100%);
                    border-radius: 12px;
                    padding: 12px;
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), inset 0 2px 8px rgba(255, 255, 255, 0.1);
                    border: 2px solid rgba(59, 130, 246, 0.5);
                    margin-top: 15px;
                    overflow-y: auto;
                ">
                    <!-- Header del √°rea de jugadas -->
                    <div style="text-align: center; margin-bottom: 10px;">
                        <h3 style="color: #fbbf24; margin: 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); font-size: 1.3rem;">
                            üé≤ Resoluci√≥n de Jugada
                        </h3>
                        <div id="play-status" style="color: #93c5fd; margin-top: 4px; font-size: 0.9rem; font-weight: 500;">
                            ‚ö° Sistema activo - Esperando tirada...
                        </div>
                    </div>

                    <!-- Contenedor donde aparecer√°n todas las tablas de cascada -->
                    <div id="cascade-tables-container" style="
                        display: flex;
                        flex-direction: column;
                        gap: 8px;
                        width: 100%;
                    ">
                        <!-- Las tablas ser√°n movidas aqu√≠ por JavaScript al cargar la p√°gina -->
                    </div>

                    <!-- SELECTOR DE TIPO DE ROBO -->
                    <div id="steal-type-selector" style="display: none; text-align: center; padding: 12px;">
                        <h4 style="color: #fbbf24; margin-bottom: 12px; font-size: 1.1rem;">üèÉ‚Äç‚ôÇÔ∏è Selecciona Tipo de Robo</h4>
                        <div style="display: flex; gap: 12px; justify-content: center;">
                            <button id="single-steal-btn" onclick="selectStealType('single')" style="
                                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                                color: white;
                                border: none;
                                padding: 12px 24px;
                                border-radius: 8px;
                                font-size: 1rem;
                                font-weight: bold;
                                cursor: pointer;
                                box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
                                transition: all 0.3s;
                            " onmouseover="if(!this.disabled) this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                üèÉ‚Äç‚ôÇÔ∏è Single Steal
                            </button>
                            <button id="double-steal-btn" onclick="selectStealType('double')" style="
                                background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
                                color: white;
                                border: none;
                                padding: 12px 24px;
                                border-radius: 8px;
                                font-size: 1rem;
                                font-weight: bold;
                                cursor: pointer;
                                box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
                                transition: all 0.3s;
                            " onmouseover="if(!this.disabled) this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                üèÉ‚Äç‚ôÇÔ∏èüèÉ‚Äç‚ôÇÔ∏è Double Steal
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ODDITIES TABLE -->
                <div id="oddities-table-container" class="result-table-inline" style="display: none; margin-bottom: 20px; animation: slideDown 0.3s ease-out;">
                    <div class="card shadow-lg" style="border: 2px solid #8b5cf6;">
                        <div class="card-body">
                            <h5 class="card-title text-center text-white mb-3">üé≤ ODDITIES TABLE (2d10)</h5>

                            <!-- Sistema de dados 2d10 -->
                            <div class="dice-display mb-4">
                                <div class="dice-item">
                                    <div class="dice-label">DADO 1 (D10)</div>
                                    <div class="dice-visual">
                                        <span class="dice-type">D10</span>
                                        <input type="number" class="dice-value-input" id="oddity-dice1-value" placeholder="-" min="1" max="10">
                                        <div class="mini-dice" onclick="rollOddityDice1()" title="Tirar dado 1">üé≤</div>
                                    </div>
                                </div>
                                <div class="dice-operator">+</div>
                                <div class="dice-item">
                                    <div class="dice-label">DADO 2 (D10)</div>
                                    <div class="dice-visual">
                                        <span class="dice-type">D10</span>
                                        <input type="number" class="dice-value-input" id="oddity-dice2-value" placeholder="-" min="1" max="10">
                                        <div class="mini-dice" onclick="rollOddityDice2()" title="Tirar dado 2">üé≤</div>
                                    </div>
                                </div>
                                <div class="dice-operator">=</div>
                                <div class="dice-item result">
                                    <div class="dice-label">RESULTADO</div>
                                    <div class="dice-visual result">
                                        <span class="dice-value" id="oddity-result-value">-</span>
                                    </div>
                                </div>
                            </div>

                            <table class="table table-dark table-striped table-bordered table-sm">
                                <thead>
                                    <tr>
                                        <th style="width: 10%;">Result</th>
                                        <th style="width: 25%;">Oddity</th>
                                        <th style="width: 65%;">Effect</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-oddity="2">
                                        <td><strong>2</strong></td>
                                        <td><strong>Fan Interference</strong></td>
                                        <td>Even PD: Home run overturned. Batter out. Odd PD: Fan catches a sure out. At-bat continues.</td>
                                    </tr>
                                    <tr data-oddity="3">
                                        <td><strong>3</strong></td>
                                        <td><strong>Animal On Field</strong></td>
                                        <td>Roll d4: 1: Seagull steals pitcher's hat. Reduce PD by 1 for this inning. 2: Raccoon bites fielder who completed the out. Treat that fielder as B7 for rest of game. 3: Black cat spooks home team. Reduce B7/OBT by
                                            5 for one inning. 4: Streaker inspires crowd. Increase home pitcher's PD by 1.</td>
                                    </tr>
                                    <tr data-oddity="4">
                                        <td><strong>4</strong></td>
                                        <td><strong>Rain Delay</strong></td>
                                        <td>Delay lasts d100"+2 minutes.</td>
                                    </tr>
                                    <tr data-oddity="5">
                                        <td><strong>5</strong></td>
                                        <td><strong>Fielder Appears Injured</strong></td>
                                        <td>Roll on Injury table for fielder who made last out.</td>
                                    </tr>
                                    <tr data-oddity="6">
                                        <td><strong>6</strong></td>
                                        <td><strong>Pitcher Appears Injured</strong></td>
                                        <td>Roll on Injury table for pitcher.</td>
                                    </tr>
                                    <tr data-oddity="7">
                                        <td><strong>7</strong></td>
                                        <td><strong>TOOTBLAN</strong></td>
                                        <td>Lead runner thrown out on the basepaths like a nincompoop. If no runner on base, batter tagged out.</td>
                                    </tr>
                                    <tr data-oddity="8">
                                        <td><strong>8</strong></td>
                                        <td><strong>Pick-Off</strong></td>
                                        <td>Runner at first picked off. If no runner at first, treat catcher as D+ for this at-bat attempt.</td>
                                    </tr>
                                    <tr data-oddity="9">
                                        <td><strong>9</strong></td>
                                        <td><strong>Call Blown at First</strong></td>
                                        <td>If PD is even, batter is wrongly called safe. If PD is odd, batter wrongly called out. Disregard that call and the result takes place in an era that employs video replay.</td>
                                    </tr>
                                    <tr data-oddity="10">
                                        <td><strong>10</strong></td>
                                        <td><strong>Call Blown at Home Plate</strong></td>
                                        <td>If PD is even, batter draws a walk on a pitch that should have been a strike. If PD is odd, batter called out on a pitch that should have been a ball.</td>
                                    </tr>
                                    <tr data-oddity="11">
                                        <td><strong>11</strong></td>
                                        <td><strong>Hit by Pitch</strong></td>
                                        <td>Batter goes to first.</td>
                                    </tr>
                                    <tr data-oddity="12">
                                        <td><strong>12</strong></td>
                                        <td><strong>Wild Pitch</strong></td>
                                        <td>All runners advance one base.</td>
                                    </tr>
                                    <tr data-oddity="13">
                                        <td><strong>13</strong></td>
                                        <td><strong>Batter Distracted</strong></td>
                                        <td>Add 1 to any defensive value for this at-bat.</td>
                                    </tr>
                                    <tr data-oddity="14">
                                        <td><strong>14</strong></td>
                                        <td><strong>Dropped Third Strike</strong></td>
                                        <td>Roll d8 for stolen base. If roll is successful, batter reaches first.</td>
                                    </tr>
                                    <tr data-oddity="15">
                                        <td><strong>15</strong></td>
                                        <td><strong>Passed Ball</strong></td>
                                        <td>All runners advance one base.</td>
                                    </tr>
                                    <tr data-oddity="16">
                                        <td><strong>16</strong></td>
                                        <td><strong>Current Batter Appears Injured</strong></td>
                                        <td>Roll on Injury table for current batter.</td>
                                    </tr>
                                    <tr data-oddity="17">
                                        <td><strong>17</strong></td>
                                        <td><strong>Previous Batter Appears Injured</strong></td>
                                        <td>Roll on Injury table for previous batter.</td>
                                    </tr>
                                    <tr data-oddity="18">
                                        <td><strong>18</strong></td>
                                        <td><strong>Pitcher Error</strong></td>
                                        <td>Batter reaches first. All runners advance one base.</td>
                                    </tr>
                                    <tr data-oddity="19">
                                        <td><strong>19</strong></td>
                                        <td><strong>Balk</strong></td>
                                        <td>All runners advance one base.</td>
                                    </tr>
                                    <tr data-oddity="20">
                                        <td><strong>20</strong></td>
                                        <td><strong>Catcher Interference</strong></td>
                                        <td>Batter goes to first.</td>
                                    </tr>
                                </tbody>
                            </table>

                            <div id="oddity-result-display" class="text-center mb-3" style="display: none; padding: 10px; background: rgba(139, 92, 246, 0.2); border-radius: 6px; color: white; font-size: 1.1rem;">
                            </div>

                            <div class="text-center mt-3">
                                <button class="btn btn-success" onclick="closeOdditiesTable()" id="oddity-continue-btn" style="display: none;">‚úì Continuar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BUNTING TABLE (D6) -->
                <div id="bunting-table-container" class="result-table-inline" style="display: none; margin-bottom: 20px; animation: slideDown 0.3s ease-out;">
                    <div class="card shadow-lg" style="border: 2px solid #f59e0b;">
                        <div class="card-body">
                            <h5 class="card-title text-center text-white mb-3">‚öæ BUNTING (D6)</h5>

                            <!-- Sistema de dado D6 -->
                            <div class="dice-display mb-3">
                                <div class="dice-item">
                                    <div class="dice-label">TOQUE (D6)</div>
                                    <div class="dice-visual">
                                        <span class="dice-type">D6</span>
                                        <input type="number" class="dice-value-input" id="bunting-dice-value" placeholder="-" min="1" max="6">
                                        <div class="mini-dice" onclick="rollBuntingD6()" title="Tirar D6">üé≤</div>
                                    </div>
                                </div>
                                <div class="dice-operator">=</div>
                                <div class="dice-item result">
                                    <div class="dice-label">RESULTADO</div>
                                    <div class="dice-visual result">
                                        <span class="dice-value" id="bunting-result-value">-</span>
                                    </div>
                                </div>
                            </div>

                            <table class="table table-dark table-striped table-bordered table-sm" style="font-size: 0.85rem;">
                                <thead>
                                    <tr>
                                        <th style="width: 15%;">Roll</th>
                                        <th style="width: 35%;">Situation</th>
                                        <th style="width: 50%;">Result</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-bunt="1-2">
                                        <td><strong>1-2</strong></td>
                                        <td>All batters</td>
                                        <td>Lead runner out, batter safe</td>
                                    </tr>
                                    <tr data-bunt="3">
                                        <td><strong>3</strong></td>
                                        <td>Lead runner at 1st or 2nd<br>Lead runner at 3rd</td>
                                        <td>Lead runner advances, batter out<br>Lead runner out, batter safe</td>
                                    </tr>
                                    <tr data-bunt="4-5">
                                        <td><strong>4-5</strong></td>
                                        <td>All batters</td>
                                        <td>Lead runner advances, batter out</td>
                                    </tr>
                                    <tr data-bunt="6">
                                        <td><strong>6</strong></td>
                                        <td>5+ hitter batting<br>All other batters</td>
                                        <td>Single, DEF (3B)<br>Lead runner advances, batter out</td>
                                    </tr>
                                </tbody>
                            </table>

                            <div id="bunting-result-display" class="text-center mb-2" style="display: none; padding: 8px; background: rgba(245, 158, 11, 0.2); border-radius: 6px; color: white; font-size: 1rem;">
                            </div>

                            <div class="text-center mt-2">
                                <button class="btn btn-success btn-sm" onclick="closeBuntingTable()" id="bunting-continue-btn" style="display: none;">‚úì Continuar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MINI-TIRADOR D4 (Animal On Field) -->
                <div id="d4-mini-roller-container" class="result-table-container" style="display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); z-index: 10000; overflow-y: auto; padding: 20px;">
                    <div class="card shadow-lg" style="max-width: 500px; margin: 2rem auto;">
                        <div class="card-body">
                            <h5 class="card-title text-center text-white mb-3">üê¶ ANIMAL ON FIELD (D4)</h5>

                            <div class="dice-display mb-4" style="justify-content: center;">
                                <div class="dice-item">
                                    <div class="dice-label">D4</div>
                                    <div class="dice-visual">
                                        <span class="dice-type">D4</span>
                                        <input type="number" class="dice-value-input" id="d4-value" placeholder="-" min="1" max="4" readonly>
                                        <div class="mini-dice" onclick="rollD4()" title="Tirar D4">üé≤</div>
                                    </div>
                                </div>
                            </div>

                            <div id="d4-result-text" class="text-white text-center mb-3" style="font-size: 1.1rem; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: 8px; display: none;">
                                <strong id="d4-animal-name"></strong>
                                <p id="d4-animal-effect" style="margin-top: 0.5rem;"></p>
                            </div>

                            <div class="text-center mt-3">
                                <button class="btn btn-success" onclick="closeD4Roller()" id="d4-continue-btn" style="display: none;">‚úì Continuar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MINI-TIRADOR D100 (Rain Delay) -->
                <div id="d100-mini-roller-container" class="result-table-container" style="display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); z-index: 10000; overflow-y: auto; padding: 20px;">
                    <div class="card shadow-lg" style="max-width: 500px; margin: 2rem auto;">
                        <div class="card-body">
                            <h5 class="card-title text-center text-white mb-3">üåßÔ∏è RAIN DELAY (D100)</h5>

                            <div class="dice-display mb-4" style="justify-content: center;">
                                <div class="dice-item">
                                    <div class="dice-label">D100</div>
                                    <div class="dice-visual">
                                        <span class="dice-type">D100</span>
                                        <input type="number" class="dice-value-input" id="d100-value" placeholder="-" min="1" max="100" readonly>
                                        <div class="mini-dice" onclick="rollD100ForRain()" title="Tirar D100">üé≤</div>
                                    </div>
                                </div>
                            </div>

                            <div id="d100-result-text" class="text-white text-center mb-3" style="font-size: 1.3rem; padding: 1.5rem; background: rgba(100,149,237,0.3); border-radius: 8px; display: none;">
                                <strong>‚è±Ô∏è Retraso: <span id="d100-delay-minutes">-</span> minutos</strong>
                                <p style="margin-top: 0.5rem; font-size: 0.9rem; opacity: 0.8;">El juego se reanudar√° tras el retraso</p>
                            </div>

                            <div class="text-center mt-3">
                                <button class="btn btn-success" onclick="closeD100Roller()" id="d100-continue-btn" style="display: none;">‚úì Continuar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BASE STEALING TABLE (D8) -->
                <div id="base-steal-table-container" class="result-table-container" style="display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); z-index: 10000; overflow-y: auto; padding: 20px;">
                    <div class="card shadow-lg" style="max-width: 600px; margin: 2rem auto;">
                        <div class="card-body">
                            <h5 class="card-title text-center text-white mb-3">üèÉ BASE STEALING (D8)</h5>
                            <p class="text-center text-white mb-3"><span id="base-steal-context"></span></p>

                            <div class="dice-display mb-4" style="justify-content: center;">
                                <div class="dice-item">
                                    <div class="dice-label">D8</div>
                                    <div class="dice-visual">
                                        <span class="dice-type">D8</span>
                                        <input type="number" class="dice-value-input" id="base-steal-d8-value" placeholder="-" min="1" max="8" readonly>
                                        <div class="mini-dice" onclick="rollBaseStealD8()" title="Tirar D8">üé≤</div>
                                    </div>
                                </div>
                            </div>

                            <table class="table table-dark table-striped table-bordered table-sm">
                                <thead>
                                    <tr>
                                        <th style="width: 30%;">Roll (D8)</th>
                                        <th style="width: 70%;">Result</th>
                                    </tr>
                                </thead>
                                <tbody id="base-steal-table-body">
                                    <!-- Se llenar√° din√°micamente seg√∫n el contexto -->
                                </tbody>
                            </table>

                            <div id="base-steal-result" class="text-white text-center mb-3" style="font-size: 1.1rem; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: 8px; display: none;">
                            </div>

                            <div class="text-center mt-3">
                                <button class="btn btn-success" onclick="closeBaseStealTable()" id="base-steal-continue-btn" style="display: none;">‚úì Continuar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- INJURY SEVERITY TABLE (D100) -->
                <div id="injury-severity-container" class="result-table-container" style="display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); z-index: 10000; overflow-y: auto; padding: 20px;">
                    <div class="card shadow-lg" style="max-width: 700px; margin: 2rem auto;">
                        <div class="card-body">
                            <h5 class="card-title text-center text-white mb-3">üè• INJURY SEVERITY (D100)</h5>
                            <p class="text-center text-white mb-3">Jugador lesionado: <strong id="injured-player-name">-</strong></p>

                            <div class="dice-display mb-4" style="justify-content: center;">
                                <div class="dice-item">
                                    <div class="dice-label">D100</div>
                                    <div class="dice-visual">
                                        <span class="dice-type">D100</span>
                                        <input type="number" class="dice-value-input" id="injury-severity-d100-value" placeholder="-" min="1" max="100" readonly>
                                        <div class="mini-dice" onclick="rollInjurySeverity()" title="Tirar D100">üé≤</div>
                                    </div>
                                </div>
                            </div>

                            <table class="table table-dark table-striped table-bordered table-sm">
                                <thead>
                                    <tr>
                                        <th style="width: 20%;">Roll</th>
                                        <th style="width: 80%;">Severity</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-severity="1">
                                        <td><strong>1</strong></td>
                                        <td><strong>Catastrophic.</strong> Player out for season. Roll on catastrophic injury table.</td>
                                    </tr>
                                    <tr data-severity="2-5">
                                        <td><strong>2-5</strong></td>
                                        <td><strong>Major.</strong> Player out for 2d20 games.</td>
                                    </tr>
                                    <tr data-severity="6-10">
                                        <td><strong>6-10</strong></td>
                                        <td><strong>Minor.</strong> Player out for d8 games.</td>
                                    </tr>
                                    <tr data-severity="11-75">
                                        <td><strong>11-75</strong></td>
                                        <td><strong>Superficial.</strong> Player plays with BT reduced by 5 or PD reduced by 1 for d6 games. Bonus traits are nullified.</td>
                                    </tr>
                                    <tr data-severity="76-100">
                                        <td><strong>76-100</strong></td>
                                        <td><strong>Player is unhurt</strong></td>
                                    </tr>
                                </tbody>
                            </table>

                            <div id="injury-severity-result" class="text-white text-center mb-3" style="font-size: 1.1rem; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: 8px; display: none;">
                            </div>

                            <div class="text-center mt-3">
                                <button class="btn btn-success" onclick="proceedAfterSeverity()" id="injury-severity-continue-btn" style="display: none;">‚úì Continuar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- INJURY LOCATION TABLE (D20) -->
                <div id="injury-location-container" class="result-table-container" style="display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); z-index: 10001; overflow-y: auto; padding: 20px;">
                    <div class="card shadow-lg" style="max-width: 700px; margin: 2rem auto;">
                        <div class="card-body">
                            <h5 class="card-title text-center text-white mb-3">üéØ INJURY LOCATION (D20)</h5>

                            <div class="dice-display mb-4" style="justify-content: center;">
                                <div class="dice-item">
                                    <div class="dice-label">D20</div>
                                    <div class="dice-visual">
                                        <span class="dice-type">D20</span>
                                        <input type="number" class="dice-value-input" id="injury-location-d20-value" placeholder="-" min="1" max="20" readonly>
                                        <div class="mini-dice" onclick="rollInjuryLocation()" title="Tirar D20">üé≤</div>
                                    </div>
                                </div>
                            </div>

                            <table class="table table-dark table-striped table-bordered table-sm">
                                <thead>
                                    <tr>
                                        <th style="width: 20%;">Roll</th>
                                        <th style="width: 80%;">Location</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-location="1">
                                        <td><strong>1</strong></td>
                                        <td>Head</td>
                                    </tr>
                                    <tr data-location="2-5">
                                        <td><strong>2-5</strong></td>
                                        <td>Shoulder</td>
                                    </tr>
                                    <tr data-location="6-9">
                                        <td><strong>6-9</strong></td>
                                        <td>Elbow</td>
                                    </tr>
                                    <tr data-location="10">
                                        <td><strong>10</strong></td>
                                        <td>Forearm</td>
                                    </tr>
                                    <tr data-location="11">
                                        <td><strong>11</strong></td>
                                        <td>Wrist</td>
                                    </tr>
                                    <tr data-location="12">
                                        <td><strong>12</strong></td>
                                        <td>Hand</td>
                                    </tr>
                                    <tr data-location="13-14">
                                        <td><strong>13-14</strong></td>
                                        <td>Back</td>
                                    </tr>
                                    <tr data-location="15">
                                        <td><strong>15</strong></td>
                                        <td>Oblique</td>
                                    </tr>
                                    <tr data-location="16">
                                        <td><strong>16</strong></td>
                                        <td>Hip</td>
                                    </tr>
                                    <tr data-location="17">
                                        <td><strong>17</strong></td>
                                        <td>Hamstring</td>
                                    </tr>
                                    <tr data-location="18">
                                        <td><strong>18</strong></td>
                                        <td>Knee</td>
                                    </tr>
                                    <tr data-location="19">
                                        <td><strong>19</strong></td>
                                        <td>Ankle</td>
                                    </tr>
                                    <tr data-location="20">
                                        <td><strong>20</strong></td>
                                        <td>Foot</td>
                                    </tr>
                                </tbody>
                            </table>

                            <div id="injury-location-result" class="text-white text-center mb-3" style="font-size: 1.1rem; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: 8px; display: none;">
                            </div>

                            <div class="text-center mt-3">
                                <button class="btn btn-success" onclick="closeInjurySystem()" id="injury-location-continue-btn" style="display: none;">‚úì Continuar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CATASTROPHIC INJURY TABLE (D6) -->
                <div id="catastrophic-injury-container" class="result-table-container" style="display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); z-index: 10002; overflow-y: auto; padding: 20px;">
                    <div class="card shadow-lg" style="max-width: 700px; margin: 2rem auto;">
                        <div class="card-body">
                            <h5 class="card-title text-center text-white mb-3">üíÄ CATASTROPHIC INJURY (D6)</h5>

                            <div class="dice-display mb-4" style="justify-content: center;">
                                <div class="dice-item">
                                    <div class="dice-label">D6</div>
                                    <div class="dice-visual">
                                        <span class="dice-type">D6</span>
                                        <input type="number" class="dice-value-input" id="catastrophic-d6-value" placeholder="-" min="1" max="6" readonly>
                                        <div class="mini-dice" onclick="rollCatastrophicInjury()" title="Tirar D6">üé≤</div>
                                    </div>
                                </div>
                            </div>

                            <table class="table table-dark table-striped table-bordered table-sm">
                                <thead>
                                    <tr>
                                        <th style="width: 20%;">Roll</th>
                                        <th style="width: 80%;">Catastrophic Effect</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-catastrophic="1">
                                        <td><strong>1</strong></td>
                                        <td><strong>Modern:</strong> Player retires. <strong>Ancient, head injuries only:</strong> Player dies.</td>
                                    </tr>
                                    <tr data-catastrophic="2-6">
                                        <td><strong>2-6</strong></td>
                                        <td>Permanently reduce BT by d10+2 or PD by 1.</td>
                                    </tr>
                                </tbody>
                            </table>

                            <div id="catastrophic-result" class="text-white text-center mb-3" style="font-size: 1.1rem; padding: 1rem; background: rgba(255,0,0,0.3); border-radius: 8px; display: none;">
                            </div>

                            <div class="text-center mt-3">
                                <button class="btn btn-danger" onclick="closeInjurySystem()" id="catastrophic-continue-btn" style="display: none;">‚úì Continuar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Columna derecha: Equipo local -->
            <div class="col col-local">
                <div class="team-header">
                    <h2 id="header-title-local">üè† Equipo Local</h2>
                    <div id="team-name-local" style="font-size: 24px; font-weight: 800; margin-top: -8px; margin-bottom: 8px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 0 2px 4px rgba(0,0,0,0.1);"></div>
                    <button class="config-btn" onclick="openTeamConfig('local')">‚öôÔ∏è</button>
                </div>

                <!-- Tabla de roster del equipo local -->
                <div class="roster-container">
                    <table class="roster-table" id="roster-local">
                        <thead>
                            <tr>
                                <th>Handle</th>
                                <th>#</th>
                                <th>Foto</th>
                                <th>Nombre</th>
                                <th>Posici√≥n</th>
                                <th>Mano</th>
                                <th>AVG</th>
                                <th>OBP</th>
                                <th>Traits</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="player-row" draggable="true" data-player-id="1">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">1</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador L1</td>
                                <td>
                                    <select class="position-select" data-player="1">
                                        <option value="P" selected>P</option>
                                        <option value="C">C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="1">
                                        <option value="R">R</option>
                                        <option value="L" selected>L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.265</td>
                                <td class="on-base-pct">.320</td>
                                <td>
                                    <select class="trait-select" data-player="1">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">-</td>
                            </tr>
                            <tr class="player-row" draggable="true" data-player-id="2">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">2</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador L2</td>
                                <td>
                                    <select class="position-select" data-player="2">
                                        <option value="P">P</option>
                                        <option value="C" selected>C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="2">
                                        <option value="R" selected>R</option>
                                        <option value="L">L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.280</td>
                                <td class="on-base-pct">.335</td>
                                <td>
                                    <select class="trait-select" data-player="2">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">-</td>
                            </tr>
                            <tr class="player-row" draggable="true" data-player-id="3">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">3</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador L3</td>
                                <td>
                                    <select class="position-select" data-player="3">
                                        <option value="P">P</option>
                                        <option value="C">C</option>
                                        <option value="1B" selected>1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="3">
                                        <option value="R" selected>R</option>
                                        <option value="L">L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.285</td>
                                <td class="on-base-pct">.345</td>
                                <td>
                                    <select class="trait-select" data-player="3">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">-</td>
                            </tr>
                            <tr class="player-row" draggable="true" data-player-id="4">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">4</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador L4</td>
                                <td>
                                    <select class="position-select" data-player="4">
                                        <option value="P">P</option>
                                        <option value="C">C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B" selected>2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="4">
                                        <option value="R">R</option>
                                        <option value="L" selected>L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.275</td>
                                <td class="on-base-pct">.330</td>
                                <td>
                                    <select class="trait-select" data-player="4">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">-</td>
                            </tr>
                            <tr class="player-row" draggable="true" data-player-id="5">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">5</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador L5</td>
                                <td>
                                    <select class="position-select" data-player="5">
                                        <option value="P">P</option>
                                        <option value="C">C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B" selected>3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="5">
                                        <option value="R" selected>R</option>
                                        <option value="L">L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.298</td>
                                <td class="on-base-pct">.365</td>
                                <td>
                                    <select class="trait-select" data-player="5">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">-</td>
                            </tr>
                            <tr class="player-row" draggable="true" data-player-id="6">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">6</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador L6</td>
                                <td>
                                    <select class="position-select" data-player="6">
                                        <option value="P">P</option>
                                        <option value="C">C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS" selected>SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="6">
                                        <option value="R" selected>R</option>
                                        <option value="L">L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.260</td>
                                <td class="on-base-pct">.315</td>
                                <td>
                                    <select class="trait-select" data-player="6">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">-</td>
                            </tr>
                            <tr class="player-row" draggable="true" data-player-id="7">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">7</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador L7</td>
                                <td>
                                    <select class="position-select" data-player="7">
                                        <option value="P">P</option>
                                        <option value="C">C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF" selected>LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="7">
                                        <option value="R">R</option>
                                        <option value="L" selected>L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.288</td>
                                <td class="on-base-pct">.350</td>
                                <td>
                                    <select class="trait-select" data-player="7">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">-</td>
                            </tr>
                            <tr class="player-row" draggable="true" data-player-id="8">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">8</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador L8</td>
                                <td>
                                    <select class="position-select" data-player="8">
                                        <option value="P">P</option>
                                        <option value="C">C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF" selected>CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="8">
                                        <option value="R" selected>R</option>
                                        <option value="L">L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.302</td>
                                <td class="on-base-pct">.370</td>
                                <td>
                                    <select class="trait-select" data-player="8">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">-</td>
                            </tr>
                            <tr class="player-row" draggable="true" data-player-id="9">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">9</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador L9</td>
                                <td>
                                    <select class="position-select" data-player="9">
                                        <option value="P">P</option>
                                        <option value="C">C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF" selected>RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="9">
                                        <option value="R" selected>R</option>
                                        <option value="L">L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.278</td>
                                <td class="on-base-pct">.335</td>
                                <td>
                                    <select class="trait-select" data-player="9">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- BANQUILLO EQUIPO LOCAL -->
                <div class="bench-container" id="bench-local" style="margin-top: 1rem; background: rgba(30,30,50,0.5); border-radius: 8px; padding: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <h4 style="color: #fbbf24; margin: 0; font-size: 1rem;">ü™ë Banquillo</h4>
                        <div>
                            <button onclick="toggleBench('local')" style="background: #374151; color: white; border: none; padding: 0.3rem 0.8rem; border-radius: 4px; cursor: pointer; margin-right: 0.5rem;">üëÅÔ∏è</button>
                            <button onclick="addBenchPlayer('local')" style="background: #059669; color: white; border: none; padding: 0.3rem 0.8rem; border-radius: 4px; cursor: pointer; font-weight: bold;">+ A√±adir</button>
                        </div>
                    </div>
                    <table class="roster-table bench-table" id="bench-table-local" style="font-size: 0.85rem;">
                        <thead>
                            <tr>
                                <th>Handle</th>
                                <th>#</th>
                                <th>Foto</th>
                                <th>Nombre</th>
                                <th>Posici√≥n</th>
                                <th>Mano</th>
                                <th>AVG</th>
                                <th>OBP</th>
                                <th>Traits</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="player-row" draggable="true" data-player-id="l10">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">10</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Jugador L10</td>
                                <td>
                                    <select class="position-select" data-player="l10">
                                        <option value="P">P</option>
                                        <option value="C">C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH" selected>DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="l10">
                                        <option value="R">R</option>
                                        <option value="L" selected>L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.312</td>
                                <td class="on-base-pct">.385</td>
                                <td>
                                    <select class="trait-select" data-player="l10">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">ü™ë</td>
                            </tr>
                            <tr class="player-row" draggable="true" data-player-id="l11">
                                <td class="drag-handle">‚ãÆ‚ãÆ</td>
                                <td class="player-number">11</td>
                                <td class="player-photo">üì∑</td>
                                <td class="player-name">Pitcher Alt</td>
                                <td>
                                    <select class="position-select" data-player="l11">
                                        <option value="P" selected>P</option>
                                        <option value="C">C</option>
                                        <option value="1B">1B</option>
                                        <option value="2B">2B</option>
                                        <option value="3B">3B</option>
                                        <option value="SS">SS</option>
                                        <option value="LF">LF</option>
                                        <option value="CF">CF</option>
                                        <option value="RF">RF</option>
                                        <option value="DH">DH</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="handedness-select" data-player="l11">
                                        <option value="R">R</option>
                                        <option value="L" selected>L</option>
                                    </select>
                                </td>
                                <td class="batting-avg">.165</td>
                                <td class="on-base-pct">.210</td>
                                <td>
                                    <select class="trait-select" data-player="l11">
                                        <option value="" selected>-</option>
                                        <option value="P+">P+</option>
                                        <option value="P++">P++</option>
                                        <option value="C+">C+</option>
                                        <option value="S+">S+</option>
                                        <option value="D+">D+</option>
                                        <option value="T+">T+</option>
                                        <option value="P-">P-</option>
                                        <option value="P--">P--</option>
                                        <option value="C">C</option>
                                        <option value="S-">S-</option>
                                        <option value="D-">D-</option>
                                        <option value="K+">K+</option>
                                        <option value="GB+">GB+</option>
                                        <option value="CN+">CN+</option>
                                        <option value="ST+">ST+</option>
                                        <option value="CN-">CN-</option>
                                    </select>
                                </td>
                                <td class="game-status">ü™ë</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Contenedor din√°mico para sistema de dados -->
                <div id="dice-container-local" class="dynamic-dice-container" style="display: none;">
                    <div class="dice-system">
                        <div class="dice-action-area">
                            <div class="dice-action-header">
                                <div class="current-batter-info" id="current-batter-info-local">
                                    <span class="batter-name">Bateador Actual</span>
                                    <span class="batter-stats">AVG: .000</span>
                                </div>
                                <div class="result-confirmation" id="result-confirmation-local" style="display: none;">
                                    <button class="confirm-result-btn" onclick="confirmResult('local')" id="confirm-btn-local">
                                        ‚úì Confirmar
                                    </button>
                                </div>
                            </div>
                            <div class="pitch-die-display">
                                <span class="pitch-die-label">Pitch Die:</span>
                                <span class="pitch-die-value" id="pitch-die-visitante">d12</span>
                            </div>
                            <div class="dice-controls">
                                <!-- Dados visuales lado a lado -->
                                <div class="dice-display">
                                    <div class="dice-item">
                                        <div class="dice-label">LANZADOR</div>
                                        <div class="dice-visual" id="pitcher-dice-local">
                                            <select class="dice-type-selector" id="pitcher-dice-type-local" onchange="updatePitcherDiceRange('local')">
                                                <option value="20">D20</option>
                                                <option value="12" selected>D12</option>
                                                <option value="8">D8</option>
                                                <option value="4">D4</option>
                                                <option value="-4">-D4</option>
                                                <option value="-8">-D8</option>
                                                <option value="-12">-D12</option>
                                                <option value="-20">-D20</option>
                                            </select>
                                            <input type="number" class="dice-value-input" id="pitcher-dice-value-local" placeholder="-" min="-20" max="20">
                                            <div class="mini-dice" onclick="rollPitcherDice('local')" title="Tirar dado del lanzador">üé≤</div>
                                        </div>
                                    </div>
                                    <div class="dice-operator">+</div>
                                    <div class="dice-item">
                                        <div class="dice-label">BATEADOR</div>
                                        <div class="dice-visual" id="batter-dice-local">
                                            <span class="dice-type">D100</span>
                                            <input type="number" class="dice-value-input" id="batter-dice-value-local" placeholder="-" min="1" max="100">
                                            <div class="mini-dice" onclick="rollBatterDice('local')" title="Tirar dado del bateador">üé≤</div>
                                        </div>
                                    </div>
                                    <div class="dice-operator">=</div>
                                    <div class="dice-item result">
                                        <div class="dice-label">RESULTADO</div>
                                        <div class="dice-visual result" id="total-result-local">
                                            <span class="dice-value" id="final-result-local">-</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="result-section">
                                    <div class="result-description" id="result-description-local">
                                        Esperando tirada...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- ================================================ -->
    <!-- MODAL: GESTI√ìN DE MIS EQUIPOS -->
    <!-- ================================================ -->
    <div class="modal-overlay" id="manage-teams-modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>üèÜ Mis Equipos Guardados</h3>
                <button class="modal-close" onclick="cerrarGestionEquipos()">‚úï</button>
            </div>

            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <button onclick="crearNuevoEquipo()" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #66BB6A, #4CAF50); color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer;">
                                ‚ûï Crear Nuevo Equipo
                            </button>
                </div>

                <div id="saved-teams-container" style="display: grid; gap: 15px;">
                    <!-- Se llenar√° din√°micamente -->
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" onclick="cerrarGestionEquipos()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal de configuraci√≥n de equipos (FUERA del div app) -->
    <div class="modal-overlay" id="team-config-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 99999; justify-content: center; align-items: center;">
        <div class="modal-content" style="background: white; border-radius: 12px; max-width: 800px; max-height: 90vh; overflow-y: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.5);">
            <div class="modal-header" style="padding: 20px; border-bottom: 2px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
                <h3 id="modal-title" style="margin: 0; color: #333;">‚öôÔ∏è Configurar Equipo</h3>
                <button class="modal-close" onclick="closeTeamConfig()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">‚úï</button>
            </div>

            <div class="modal-body">
                <!-- Importar desde MLB -->
                <div class="config-section">
                    <label for="mlb-team-selector">üîó Importar desde MLB (2024):</label>
                    <div style="display: flex; gap: 10px;">
                        <select id="mlb-team-selector" style="flex: 1;">
                            <option value="">Seleccionar equipo MLB...</option>
                            <option value="147">New York Yankees</option>
                            <option value="119">Los Angeles Dodgers</option>
                            <option value="111">Boston Red Sox</option>
                            <option value="137">San Francisco Giants</option>
                            <option value="145">Chicago White Sox</option>
                            <option value="116">Detroit Tigers</option>
                            <option value="117">Houston Astros</option>
                            <option value="133">Oakland Athletics</option>
                            <option value="136">Seattle Mariners</option>
                            <option value="108">Los Angeles Angels</option>
                            <option value="139">Tampa Bay Rays</option>
                            <option value="110">Baltimore Orioles</option>
                            <option value="141">Toronto Blue Jays</option>
                            <option value="114">Cleveland Guardians</option>
                            <option value="142">Minnesota Twins</option>
                            <option value="118">Kansas City Royals</option>
                            <option value="158">Milwaukee Brewers</option>
                            <option value="138">St. Louis Cardinals</option>
                            <option value="112">Chicago Cubs</option>
                            <option value="134">Pittsburgh Pirates</option>
                            <option value="113">Cincinnati Reds</option>
                            <option value="121">New York Mets</option>
                            <option value="143">Philadelphia Phillies</option>
                            <option value="144">Atlanta Braves</option>
                            <option value="146">Miami Marlins</option>
                            <option value="120">Washington Nationals</option>
                            <option value="115">Colorado Rockies</option>
                            <option value="109">Arizona Diamondbacks</option>
                            <option value="135">San Diego Padres</option>
                            <option value="140">Texas Rangers</option>
                        </select>
                        <button onclick="importMLBTeam()" class="btn-primary">Importar</button>
                    </div>
                    <div id="import-status" style="margin-top: 8px; font-size: 14px; font-weight: 500;"></div>
                </div>

                <!-- O Seleccionar desde Roster Guardado -->
                <div class="config-section">
                    <label for="preset-teams">üìã O selecciona un equipo predefinido:</label>
                    <select id="preset-teams" onchange="loadPresetTeam()">
                        <option value="">-- Seleccionar equipo --</option>
                        <option value="custom">‚úèÔ∏è Personalizado (editar manual)</option>
                    </select>
                </div>

                <!-- Bot√≥n para ver Mis Equipos Guardados -->
                <div class="config-section">
                    <button onclick="verGestionEquipos()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                        üèÜ Ver Mis Equipos Guardados
                    </button>
                </div>

                <!-- Nombre del equipo -->
                <div class="config-section">
                    <label for="team-name">üè∑Ô∏è Nombre del Equipo:</label>
                    <input type="text" id="team-name" placeholder="Ej: Yankees, Dodgers...">
                </div>

                <!-- Editor de jugadores -->
                <div class="config-section">
                    <h4>Jugadores del Equipo:</h4>
                    <div class="players-editor" id="players-editor">
                        <!-- Se llenar√° din√°micamente con JavaScript -->
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeTeamConfig()">Cancelar</button>
                <button class="btn-primary" onclick="cargarEquipoAlJuego()" style="background: #f59e0b;">üéÆ Cargar al Juego</button>
                <button id="btn-guardar-cambios" class="btn-primary" onclick="guardarEquipoPersonalizado()" style="background: #10b981; cursor: pointer;">üíæ Guardar Cambios</button>
            </div>
        </div>
    </div>

    <style>
        /* ================================================== */
        /* NUEVO LAYOUT: Header + Carrusel + Juego/Chat + Footer */
        /* ================================================== */
        
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
            background: #1a1a2e;
            /* Fondo oscuro */
        }
        /* ================================================== */
        /* HEADER CON CARRUSEL DE FOTOS */
        /* ================================================== */
        
        .main-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 100;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .game-title {
            color: white;
            text-align: center;
            font-size: 2.5rem;
            margin: 0 0 20px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            font-weight: bold;
        }
        
        .team-carousel-container {
            width: 100%;
        }
        
        .carousel-wrapper {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        
        .team-carousel {
            display: flex;
            transition: transform 0.5s ease-in-out;
            position: relative;
        }
        
        .carousel-slide {
            min-width: 100%;
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .carousel-slide.active {
            display: block;
        }
        
        .carousel-slide img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .carousel-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 24px;
            border-radius: 4px;
            transition: all 0.3s;
            z-index: 10;
        }
        
        .carousel-btn:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: translateY(-50%) scale(1.1);
        }
        
        .carousel-btn.prev {
            left: 10px;
        }
        
        .carousel-btn.next {
            right: 10px;
        }
        
        .carousel-dots {
            text-align: center;
            padding: 10px 0;
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }
        
        .carousel-dot {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            margin: 0 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .carousel-dot.active {
            background: white;
            transform: scale(1.3);
        }
        /* ================================================== */
        /* LAYOUT PRINCIPAL: Juego + Chat Lateral */
        /* ================================================== */
        
        .main-layout-wrapper {
            display: flex;
            flex: 1;
            gap: 0;
            max-width: 100%;
            margin: 0;
            padding: 0;
            min-height: calc(100vh - 200px);
        }
        
        .game-section {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 20px;
            background: #f5f5f5;
            min-height: 600px;
        }
        /* ================================================== */
        /* CHAT LATERAL */
        /* ================================================== */
        
        .chat-sidebar {
            width: 350px;
            background: white;
            border-left: 2px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            box-shadow: -4px 0 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            height: 100vh;
            overflow: hidden;
        }
        
        .chat-sidebar-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .chat-sidebar-header h3 {
            margin: 0 0 5px 0;
            font-size: 1.2rem;
        }
        
        .chat-user-badge {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .chat-sidebar-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: #f8f9fa;
        }
        
        .chat-loading {
            text-align: center;
            color: #999;
            padding: 20px;
        }
        
        .chat-sidebar-message {
            margin-bottom: 12px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            animation: slideInRight 0.3s ease-out;
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .chat-sidebar-message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }
        
        .chat-sidebar-username {
            font-weight: bold;
            color: #667eea;
        }
        
        .chat-sidebar-time {
            color: #999;
            font-size: 0.75rem;
        }
        
        .chat-sidebar-text {
            color: #333;
            word-wrap: break-word;
            font-size: 0.9rem;
        }
        
        .chat-sidebar-input {
            padding: 15px;
            background: white;
            border-top: 2px solid #e0e0e0;
        }
        
        .chat-sidebar-form {
            display: flex;
            gap: 10px;
        }
        
        .chat-sidebar-textinput {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .chat-sidebar-textinput:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .chat-sidebar-sendbtn {
            padding: 10px 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
        }
        
        .chat-sidebar-sendbtn:hover {
            background: #5568d3;
            transform: scale(1.05);
        }
        
        .admin-badge-chat {
            background: #fbbf24;
            color: #000;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 5px;
        }
        /* ================================================== */
        /* FOOTER */
        /* ================================================== */
        
        .main-footer {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
            padding: 30px 20px;
            margin-top: auto;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .footer-section {
            text-align: center;
        }
        
        .footer-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin: 0 0 5px 0;
        }
        
        .footer-description {
            font-size: 0.9rem;
            opacity: 0.8;
            margin: 0;
        }
        
        .footer-credits {
            margin: 0;
            line-height: 1.6;
        }
        
        .developer-name {
            font-size: 1.1rem;
            color: #fbbf24;
        }
        
        .footer-email {
            color: #60a5fa;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-email:hover {
            color: #93c5fd;
            text-decoration: underline;
        }
        
        .footer-year {
            margin: 0 0 5px 0;
            font-size: 0.9rem;
        }
        
        .footer-links {
            margin: 0;
        }
        
        .footer-links a {
            color: white;
            text-decoration: none;
            margin: 0 10px;
            transition: color 0.3s;
        }
        
        .footer-links a:hover {
            color: #fbbf24;
        }
        /* ================================================== */
        /* RESPONSIVE DESIGN */
        /* ================================================== */
        
        @media (max-width: 1200px) {
            .chat-sidebar {
                width: 300px;
            }
        }
        
        @media (max-width: 992px) {
            .main-layout-wrapper {
                flex-direction: column;
            }
            .chat-sidebar {
                width: 100%;
                height: 400px;
                border-left: none;
                border-top: 2px solid #e0e0e0;
                position: relative;
            }
            .game-title {
                font-size: 2rem;
            }
        }
        
        @media (max-width: 768px) {
            .game-title {
                font-size: 1.5rem;
            }
            .carousel-slide img {
                height: 180px;
            }
            .footer-content {
                flex-direction: column;
            }
        }
        /* ================================================== */
        /* AUDIO CONTROLS SWITCH */
        /* ================================================== */
        
        .audio-switch input:checked+.audio-slider {
            background-color: #667eea;
        }
        
        .audio-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            border-radius: 50%;
            transition: 0.4s;
        }
        
        .audio-switch input:checked+.audio-slider:before {
            transform: translateX(26px);
        }
    </style>

    </div>
    <!-- Cierre de app -->

    <!-- Script para crear ventanas flotantes con JavaScript -->
    <script>
        // ========================================
        // CREAR VENTANAS FLOTANTES DESDE JAVASCRIPT
        // ========================================

        function crearVentanas() {
            // Ventana de Audio
            const audioWindow = document.createElement('div');
            audioWindow.id = 'audioWindow';
            audioWindow.className = 'floating-window';
            audioWindow.style.cssText = 'display: block !important; position: fixed !important; top: 80px; right: 20px; width: 350px; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); z-index: 999999 !important; overflow: hidden; pointer-events: auto !important;';
            audioWindow.innerHTML = `
                <div class="window-header" style="background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; padding: 12px 15px; cursor: move; display: flex; justify-content: space-between; align-items: center; user-select: none;">
                    <span style="font-weight: bold;">üéµ Audio</span>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="minimizeWindow('audioWindow')" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 14px;">‚àí</button>
                        <button onclick="closeWindow('audioWindow')" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer;">√ó</button>
                    </div>
                </div>
                <div class="window-content" style="padding: 20px; max-height: 400px; overflow-y: auto;">
                    <div class="audio-toggle-wrapper" style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <span id="audio-icon" class="audio-icon" style="font-size: 24px;">üîä</span>
                        <div class="audio-switch" onclick="AudioSystem.toggleAudio()" style="position: relative; display: inline-block; width: 50px; height: 24px; cursor: pointer;">
                            <input type="checkbox" id="audio-toggle" checked style="display: none;">
                            <span class="audio-slider" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; border-radius: 24px; transition: 0.4s; pointer-events: none;"></span>
                        </div>
                    </div>
                    <div class="volume-control" style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-size: 14px; color: #555;">üéµ M√∫sica:</label>
                        <input type="range" id="music-volume" min="0" max="100" value="30" oninput="AudioSystem.setMusicVolume(this.value / 100)" style="width: 100%;">
                    </div>
                    <div class="volume-control">
                        <label style="display: block; margin-bottom: 5px; font-size: 14px; color: #555;">üîî Efectos:</label>
                        <input type="range" id="sfx-volume" min="0" max="100" value="50" oninput="AudioSystem.setSfxVolume(this.value / 100)" style="width: 100%;">
                    </div>
                </div>
            `;
            document.body.appendChild(audioWindow);

            // Ventana de Chat
            const chatWindow = document.createElement('div');
            chatWindow.id = 'chatWindow';
            chatWindow.className = 'floating-window';
            chatWindow.style.cssText = 'display: block !important; position: fixed !important; top: 80px; left: 20px; width: 400px; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); z-index: 999999 !important; overflow: hidden; pointer-events: auto !important;';
            chatWindow.innerHTML = `
                <div class="window-header" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 12px 15px; cursor: move; display: flex; justify-content: space-between; align-items: center; user-select: none;">
                    <div>
                        <span style="font-weight: bold;">üí¨ Chat</span>
                        <span id="chatUserBadge" style="font-size: 0.8rem; opacity: 0.9; margin-left: 10px;">...</span>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="minimizeWindow('chatWindow')" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 14px;">‚àí</button>
                        <button onclick="closeWindow('chatWindow')" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer;">√ó</button>
                    </div>
                </div>
                <div class="window-content" style="padding: 0; height: 400px; display: flex; flex-direction: column;">
                    <div class="chat-sidebar-messages" id="chatSidebarMessages" style="flex: 1; overflow-y: auto; padding: 15px; background: #f9fafb;">
                        <div class="chat-loading">Cargando mensajes...</div>
                    </div>
                    <div class="chat-sidebar-input" style="padding: 15px; border-top: 1px solid #e5e7eb; background: white;">
                        <form id="chatSidebarForm" class="chat-sidebar-form" style="display: flex; gap: 10px;">
                            <input type="text" id="chatSidebarInput" class="chat-sidebar-textinput" placeholder="Escribe un mensaje..." maxlength="500" autocomplete="off" required style="flex: 1; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
                            <button type="submit" class="chat-sidebar-sendbtn" style="padding: 10px 15px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">üì§</button>
                        </form>
                    </div>
                </div>
            `;
            document.body.appendChild(chatWindow);

            // Ventana de Hall of Fame
            const hallWindow = document.createElement('div');
            hallWindow.id = 'hallWindow';
            hallWindow.className = 'floating-window';
            hallWindow.style.cssText = 'display: block !important; position: fixed !important; top: 300px; left: 20px; width: 500px; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); z-index: 999999 !important; overflow: hidden; pointer-events: auto !important;';
            hallWindow.innerHTML = `
                <div class="window-header" style="background: linear-gradient(135deg, #fbbf24, #f59e0b); color: white; padding: 12px 15px; cursor: move; display: flex; justify-content: space-between; align-items: center; user-select: none;">
                    <span style="font-weight: bold;">üèÜ Hall of Fame</span>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="minimizeWindow('hallWindow')" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 14px;">‚àí</button>
                        <button onclick="closeWindow('hallWindow')" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer;">√ó</button>
                    </div>
                </div>
                <div class="window-content" style="padding: 20px; max-height: 400px; overflow-y: auto;">
                    <div id="hallOfFameContent">
                        <div style="text-align: center; color: #999;">Cargando ranking...</div>
                    </div>
                    <button onclick="cargarHallOfFame()" style="width: 100%; margin-top: 15px; padding: 12px; background: #fbbf24; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">üîÑ Actualizar</button>
                </div>
            `;
            document.body.appendChild(hallWindow);

            console.log('‚úÖ Ventanas creadas y a√±adidas al DOM');
            console.log('audioWindow:', document.getElementById('audioWindow'));
            console.log('chatWindow:', document.getElementById('chatWindow'));
            console.log('hallWindow:', document.getElementById('hallWindow'));

            // Hacer ventanas arrastrables
            makeDraggable();
        }

        function minimizeWindow(windowId) {
            const win = document.getElementById(windowId);
            if (!win) return;
            const content = win.querySelector('.window-content');
            if (content.style.display === 'none') {
                content.style.display = 'block';
            } else {
                content.style.display = 'none';
            }
        }

        function closeWindow(windowId) {
            const win = document.getElementById(windowId);
            if (win) win.style.display = 'none';
        }

        function openWindow(windowId) {
            const win = document.getElementById(windowId);
            if (win) {
                win.style.display = 'block';
                win.style.zIndex = 2000;
            }
        }

        // Hacer ventanas arrastrables
        function makeDraggable() {
            const windows = document.querySelectorAll('.floating-window');

            windows.forEach(win => {
                const header = win.querySelector('.window-header');
                if (!header) return;

                let isDragging = false;
                let currentX, currentY, initialX, initialY;

                header.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    initialX = e.clientX - win.offsetLeft;
                    initialY = e.clientY - win.offsetTop;
                    win.style.zIndex = 2000;
                });

                document.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        e.preventDefault();
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;
                        win.style.left = currentX + 'px';
                        win.style.top = currentY + 'px';
                    }
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
            });

            console.log('‚úÖ Ventanas arrastrables inicializadas');
        }

        // Funciones de compatibilidad con botones
        function toggleChat() {
            const win = document.getElementById('chatWindow');
            if (!win) {
                console.error('chatWindow no encontrado');
                return;
            }
            if (win.style.display === 'none' || win.style.display === '') {
                openWindow('chatWindow');
            } else {
                closeWindow('chatWindow');
            }
        }

        function toggleHall() {
            const win = document.getElementById('hallWindow');
            if (!win) {
                console.error('hallWindow no encontrado');
                return;
            }
            if (win.style.display === 'none' || win.style.display === '') {
                openWindow('hallWindow');
                if (typeof cargarHallOfFame === 'function') cargarHallOfFame();
            } else {
                closeWindow('hallWindow');
            }
        }

        function toggleAudioModal() {
            const win = document.getElementById('audioWindow');
            if (!win) {
                console.error('audioWindow no encontrado');
                return;
            }
            if (win.style.display === 'none' || win.style.display === '') {
                openWindow('audioWindow');
            } else {
                closeWindow('audioWindow');
            }
        }

        // EJECUTAR INMEDIATAMENTE - El script est√° al final del HTML
        console.log('üöÄ Ejecutando crearVentanas...');
        crearVentanas();
    </script>

    <!-- ================================================== -->
    <!-- BOTONES FLOTANTES TOGGLE -->
    <!-- ================================================== -->

    <!-- Botones flotantes ocultos (ahora est√°n en el marcador) -->
    <button id="chat-toggle-btn" onclick="toggleChat()" style="display: none;">
        üí¨
    </button>

    <button id="hall-toggle-btn" onclick="toggleHall()" style="display: none;">
        üèÜ
    </button>

    <button id="logout-btn" onclick="logout()" title="Cerrar sesi√≥n" style="display: none;">
        üö™
    </button>

    <!-- ================================================== -->
    <!-- MODALES -->
    <!-- ================================================== -->

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <!-- Sistema de autenticaci√≥n -->
    <script src="auth.js"></script>
    <!-- ================================================== -->
    <!-- VERIFICACI√ìN DE AUTENTICACI√ìN -->
    <!-- ================================================== -->
    <!-- Este script asegura que solo usuarios autenticados puedan jugar -->
    <script>
        // ================================================
        // VERIFICAR QUE EL USUARIO EST√Å LOGUEADO
        // ================================================
        // estaLogueado() verifica si hay un token en localStorage
        if (!estaLogueado()) {
            // Si NO est√° logueado, mostrar alerta y redirigir al login
            alert('Debes iniciar sesi√≥n para jugar');
            window.location.href = 'login.html';
        } else {
            // Si S√ç est√° logueado, obtener sus datos
            const usuario = getUsuarioActual();
            console.log('Usuario logueado:', usuario.nombre);

            // Aqu√≠ podr√≠as mostrar el nombre del usuario en la UI
            // Por ejemplo:
            // document.getElementById('userNameDisplay').textContent = usuario.nombre;
        }
    </script>

    <!-- Sistema de audio -->
    <script src="audio_system.js"></script>

    <!-- Enlazamos el archivo de JavaScript personalizado -->
    <script src="script_new.js?v=3"></script>

    <!-- ================================================== -->
    <!-- SOCKET.IO para Chat en Tiempo Real -->
    <!-- ================================================== -->
    <script src="http://localhost:3000/socket.io/socket.io.js"></script>

    <!-- ================================================== -->
    <!-- FUNCIONES GLOBALES PARA FOTOS (deben cargarse temprano) -->
    <!-- ================================================== -->
    <script>
        console.log('üöÄ FUNCIONES DE FOTOS CARGADAS');

        // Variables globales
        window.photoPlayerId = null;
        window.photoTeam = null;
        window.photoBlob = null;

        // Abrir modal
        window.openPhotoModal = function(playerId, team) {
            console.log('üì∏ Abriendo modal foto para:', playerId, team);
            window.photoPlayerId = playerId;
            window.photoTeam = team;
            window.photoBlob = null;
            document.getElementById('photoPreview').innerHTML = 'üì∑';
            document.getElementById('photoPreview').style.backgroundImage = '';
            const modal = document.getElementById('playerPhotoModal');
            modal.style.display = 'flex';

            // BLOQUEAR TODO EL RESTO DE LA P√ÅGINA
            document.body.style.pointerEvents = 'none';
            modal.style.pointerEvents = 'auto';
        };

        // Cerrar modal
        window.closePhotoModal = function() {
            console.log('‚ùå Cerrando modal foto');
            const modal = document.getElementById('playerPhotoModal');
            modal.style.display = 'none';
            document.getElementById('playerPhotoInput').value = '';
            window.photoPlayerId = null;
            window.photoTeam = null;
            window.photoBlob = null;

            // DESBLOQUEAR LA P√ÅGINA
            document.body.style.pointerEvents = 'auto';
        };

        // Funci√≥n de guardado
        window.guardarFotoJugador = function() {
            console.log('üî• GUARDAR FOTO INICIADO');

            if (!window.photoBlob) {
                alert('Selecciona una imagen primero');
                return;
            }

            const token = localStorage.getItem('token');
            if (!token) {
                alert('Debes iniciar sesi√≥n');
                return;
            }

            console.log('‚¨ÜÔ∏è Subiendo foto...');
            const formData = new FormData();
            formData.append('photo', window.photoBlob, 'player-photo.jpg');

            fetch('http://localhost:3000/api/upload/player-photo', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                })
                .then(response => {
                    console.log('üì• Respuesta:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('‚úÖ Data:', data);

                    if (data.imageUrl) {
                        const selector = window.photoTeam === 'modal-edit' ?
                            `#modal-roster-table tr[data-player-id="${window.photoPlayerId}"] .player-photo, #modal-bench-table tr[data-player-id="${window.photoPlayerId}"] .player-photo` :
                            `#roster-${window.photoTeam} tr[data-player-id="${window.photoPlayerId}"] .player-photo, #bench-table-${window.photoTeam} tr[data-player-id="${window.photoPlayerId}"] .player-photo`;

                        const photoCell = document.querySelector(selector);
                        if (photoCell) {
                            photoCell.innerHTML = `<img src="http://localhost:3000${data.imageUrl}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">`;
                            photoCell.dataset.photoUrl = data.imageUrl;
                            console.log('üéâ Foto actualizada');
                        }

                        window.closePhotoModal();
                    } else {
                        alert('Error al guardar');
                    }
                })
                .catch(err => {
                    console.error('‚ùå Error:', err);
                    alert('Error al guardar la foto');
                });
        };
    </script>

    <!-- ================================================== -->
    <!-- SCRIPT: Carrusel de Fotos -->
    <!-- ================================================== -->
    <script>
        let currentSlide = 0;
        const slides = document.querySelectorAll('.carousel-slide');
        const totalSlides = slides.length;

        // Crear dots din√°micamente
        const dotsContainer = document.getElementById('carouselDots');
        for (let i = 0; i < totalSlides; i++) {
            const dot = document.createElement('span');
            dot.className = 'carousel-dot' + (i === 0 ? ' active' : '');
            dot.onclick = () => goToSlide(i);
            dotsContainer.appendChild(dot);
        }

        function moveCarousel(direction) {
            currentSlide += direction;
            if (currentSlide < 0) currentSlide = totalSlides - 1;
            if (currentSlide >= totalSlides) currentSlide = 0;
            updateCarousel();
        }

        function goToSlide(index) {
            currentSlide = index;
            updateCarousel();
        }

        function updateCarousel() {
            slides.forEach((slide, index) => {
                slide.classList.toggle('active', index === currentSlide);
            });

            const dots = document.querySelectorAll('.carousel-dot');
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentSlide);
            });
        }

        // Auto-play del carrusel cada 5 segundos
        setInterval(() => {
            moveCarousel(1);
        }, 5000);
    </script>

    <!-- ================================================== -->
    <!-- SCRIPT: Chat Lateral en Tiempo Real -->
    <!-- ================================================== -->
    <script>
        // Obtener datos del usuario
        const chatUsuario = getUsuarioActual();
        const isAdminChat = chatUsuario.isAdmin === 1;

        // Esperar a que las ventanas existan
        function inicializarChatCuandoExista() {
            const chatUserBadge = document.getElementById('chatUserBadge');
            const chatMessages = document.getElementById('chatSidebarMessages');
            const chatForm = document.getElementById('chatSidebarForm');
            const chatInput = document.getElementById('chatSidebarInput');

            if (!chatUserBadge || !chatMessages || !chatForm || !chatInput) {
                console.log('‚è≥ Esperando elementos del chat...');
                setTimeout(inicializarChatCuandoExista, 50);
                return;
            }

            console.log('‚úÖ Elementos del chat encontrados, inicializando...');

            // Verificar que Socket.IO est√© cargado
            if (typeof io === 'undefined') {
                console.error('‚ùå Socket.IO no est√° cargado');
                return;
            }

            // Actualizar badge del usuario
            chatUserBadge.textContent = chatUsuario.nombre + (isAdminChat ? ' üëë' : '');

            // Conectar a Socket.IO
            const socketChat = io('http://localhost:3000');

            // ================================================
            // CARGAR HISTORIAL DE MENSAJES
            // ================================================
            async function cargarChatHistorial() {
                try {
                    const response = await fetch('http://localhost:3000/api/chat/messages?limit=50');
                    const messages = await response.json();

                    chatMessages.innerHTML = '';

                    if (messages.length === 0) {
                        chatMessages.innerHTML = '<div class="chat-loading">No hay mensajes a√∫n</div>';
                    } else {
                        messages.forEach(msg => {
                            mostrarMensajeChat(msg.id, msg.username, msg.message, msg.created_at);
                        });
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }
                } catch (error) {
                    console.error('Error al cargar chat:', error);
                    chatMessages.innerHTML = '<div class="chat-loading">Error al cargar mensajes</div>';
                }
            }

            // ================================================
            // MOSTRAR MENSAJE EN EL CHAT
            // ================================================
            function mostrarMensajeChat(messageId, username, message, timestamp) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-sidebar-message';
                messageDiv.dataset.messageId = messageId;

                const fecha = new Date(timestamp);
                const tiempo = fecha.toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const adminBadge = isAdminChat && username === chatUsuario.nombre ?
                    '<span class="admin-badge-chat">ADMIN</span>' : '';

                messageDiv.innerHTML = `
                <div class="chat-sidebar-message-header">
                    <span class="chat-sidebar-username">${escapeHtmlChat(username)}${adminBadge}</span>
                    <span class="chat-sidebar-time">${tiempo}</span>
                </div>
                <div class="chat-sidebar-text">${escapeHtmlChat(message)}</div>
            `;

                chatMessages.appendChild(messageDiv);
            }

            // Escapar HTML para prevenir XSS
            function escapeHtmlChat(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            // ================================================
            // ENVIAR MENSAJE
            // ================================================
            chatForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const message = chatInput.value.trim();
                if (!message) return;

                socketChat.emit('chat-message', {
                    userId: chatUsuario.id,
                    username: chatUsuario.nombre,
                    message: message
                });

                chatInput.value = '';
                chatInput.focus();
            });

            // ================================================
            // RECIBIR MENSAJES EN TIEMPO REAL
            // ================================================
            socketChat.on('chat-message', (data) => {
                mostrarMensajeChat(data.id, data.username, data.message, data.timestamp);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            });

            // Conexi√≥n establecida
            socketChat.on('connect', () => {
                console.log('‚úÖ Chat conectado');
            });

            // Desconexi√≥n
            socketChat.on('disconnect', () => {
                console.log('‚ùå Chat desconectado');
            });

            // Cargar historial al iniciar
            cargarChatHistorial();
        }

        // Iniciar cuando el script se cargue - con delay para Socket.IO
        setTimeout(inicializarChatCuandoExista, 100);
    </script>

    <!-- ================================================ -->
    <style>
        /* Hall of Fame Sidebar */
        
        .hall-of-fame-sidebar {
            width: 350px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-left: 3px solid #ffd700;
            display: flex;
            flex-direction: column;
            max-height: 100vh;
            position: sticky;
            top: 0;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.3);
        }
        
        .hall-of-fame-header {
            padding: 20px;
            background: rgba(255, 215, 0, 0.1);
            border-bottom: 2px solid #ffd700;
            text-align: center;
        }
        
        .hall-of-fame-header h3 {
            margin: 0;
            color: #ffd700;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .hall-subtitle {
            margin: 5px 0 0 0;
            color: #ffffff;
            font-size: 12px;
            opacity: 0.8;
        }
        
        .hall-of-fame-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        /* Tabla de Rankings */
        
        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .ranking-table thead {
            background: rgba(255, 215, 0, 0.2);
        }
        
        .ranking-table th {
            padding: 12px 8px;
            color: #ffd700;
            font-size: 13px;
            font-weight: bold;
            text-align: center;
            border-bottom: 2px solid #ffd700;
        }
        
        .ranking-table td {
            padding: 10px 8px;
            color: #ffffff;
            font-size: 13px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .ranking-table tr:hover {
            background: rgba(255, 215, 0, 0.1);
        }
        /* Medallas para top 3 */
        
        .rank-medal {
            font-size: 16px;
            font-weight: bold;
        }
        
        .rank-1 {
            color: #FFD700;
        }
        /* Oro */
        
        .rank-2 {
            color: #C0C0C0;
        }
        /* Plata */
        
        .rank-3 {
            color: #CD7F32;
        }
        /* Bronce */
        
        .player-alias {
            font-weight: bold;
            color: #ffffff;
        }
        
        .stat-games {
            color: #4FC3F7;
        }
        
        .stat-wins {
            color: #66BB6A;
        }
        
        .stat-losses {
            color: #EF5350;
        }
        
        .hall-loading {
            text-align: center;
            color: #ffffff;
            padding: 40px 20px;
            font-size: 14px;
            opacity: 0.7;
        }
        
        .hall-of-fame-footer {
            padding: 15px;
            border-top: 2px solid #ffd700;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .refresh-ranking-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #1e3c72;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .refresh-ranking-btn:hover {
            background: linear-gradient(135deg, #ffed4e, #ffd700);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        /* Responsivo */
        
        @media (max-width: 1400px) {
            .hall-of-fame-sidebar {
                width: 300px;
            }
        }
        
        @media (max-width: 1200px) {
            .main-layout-wrapper {
                flex-direction: column;
            }
            .hall-of-fame-sidebar,
            .chat-sidebar {
                width: 100%;
                max-height: 400px;
            }
        }
    </style>

    <!-- ================================================ -->
    <!-- FUNCIONES: GUARDAR/CARGAR PARTIDAS + HALL OF FAME -->
    <!-- ================================================ -->
    <script>
        // ================================================
        // GUARDAR PARTIDA
        // ================================================
        async function guardarPartida() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Debes iniciar sesi√≥n para guardar partidas');
                    return;
                }

                // Verificar que hay un juego activo
                if (!window.gameStateData || !window.gameStateData.isGameActive) {
                    alert('‚ö†Ô∏è No hay ninguna partida en curso para guardar');
                    return;
                }

                const gameState = window.gameStateData;

                // Recopilar estado actual del juego desde script_new.js
                const estadoPartida = {
                    homeTeam: window.homeTeam || 'Local',
                    awayTeam: window.awayTeam || 'Visitante',
                    homeScore: window.homeScore || 0,
                    awayScore: window.awayScore || 0,
                    inning: window.inning || 1,
                    isTopInning: window.isTopInning !== undefined ? window.isTopInning : true,
                    outs: window.outs || 0,
                    bases: window.bases || [false, false, false],
                    gameState: {
                        // Estado completo del juego para restaurar
                        strikes: window.strikes || 0,
                        balls: window.balls || 0,
                        visitanteBatterIndex: gameState.visitanteBatterIndex || 0,
                        localBatterIndex: gameState.localBatterIndex || 0,
                        score: gameState.score || {
                            visitante: [0, 0, 0, 0, 0, 0, 0, 0, 0],
                            local: [0, 0, 0, 0, 0, 0, 0, 0, 0],
                            totalVisitante: 0,
                            totalLocal: 0
                        },
                        hits: gameState.hits || {
                            visitante: 0,
                            local: 0
                        },
                        errors: gameState.errors || {
                            visitante: 0,
                            local: 0
                        },
                        pitcher: gameState.pitcher || null
                    }
                };

                const response = await fetch('http://localhost:3000/api/games/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(estadoPartida)
                });

                const data = await response.json();

                if (response.ok) {
                    alert('‚úÖ Partida guardada correctamente');
                    // Actualizar Hall of Fame despu√©s de guardar
                    cargarHallOfFame();
                } else {
                    alert(`‚ùå Error: ${data.error}`);
                }
            } catch (error) {
                console.error('Error al guardar partida:', error);
                alert('‚ùå Error al guardar la partida');
            }
        }

        // ================================================
        // MOSTRAR LISTA DE PARTIDAS GUARDADAS
        // ================================================
        async function mostrarPartidas() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Debes iniciar sesi√≥n para ver tus partidas');
                    return;
                }

                const response = await fetch('http://localhost:3000/api/games?limit=20', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (!response.ok) {
                    alert(`‚ùå Error: ${data.error}`);
                    return;
                }

                // Crear modal con lista de partidas
                mostrarModalPartidas(data.games);
            } catch (error) {
                console.error('Error al cargar partidas:', error);
                alert('‚ùå Error al cargar las partidas');
            }
        }

        // ================================================
        // MODAL CON LISTA DE PARTIDAS
        // ================================================
        function mostrarModalPartidas(games) {
            // Remover overlay anterior si existe
            const oldOverlay = document.getElementById('games-modal-overlay');
            if (oldOverlay) oldOverlay.remove();

            // Crear overlay
            const overlay = document.createElement('div');
            overlay.id = 'games-modal-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 10000;
                display: flex;
                justify-content: center;
                align-items: center;
            `;

            // Crear modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: linear-gradient(135deg, #1e3c72, #2a5298);
                padding: 30px;
                border-radius: 15px;
                max-width: 600px;
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
                border: 3px solid #ffd700;
            `;

            let html = `
                <h2 style="color: #ffd700; margin-top: 0; text-align: center;">üìÇ Partidas Guardadas</h2>
            `;

            if (games.length === 0) {
                html += `<p style="color: white; text-align: center;">No tienes partidas guardadas</p>`;
            } else {
                html += `<div style="display: grid; gap: 15px;">`;
                games.forEach(game => {
                    const fecha = new Date(game.game_date).toLocaleString('es-ES');
                    const estado = game.completed ? '‚úÖ Completada' : '‚è∏Ô∏è En curso';
                    html += `
                        <div style="
                            background: rgba(255, 255, 255, 0.1);
                            padding: 15px;
                            border-radius: 10px;
                            border: 2px solid rgba(255, 215, 0, 0.3);
                            cursor: pointer;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.background='rgba(255, 215, 0, 0.2)'" 
                           onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'"
                           onclick="cargarPartida(${game.id})">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="color: white; font-weight: bold;">‚öæ ${game.home_team} vs ${game.away_team}</span>
                                <span style="color: #4FC3F7; font-size: 12px;">${fecha}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: #66BB6A; font-size: 18px; font-weight: bold;">${game.home_score} - ${game.away_score}</span>
                                <span style="color: ${game.completed ? '#66BB6A' : '#FFD700'}; font-size: 12px;">${estado}</span>
                            </div>
                            <div style="margin-top: 8px; font-size: 12px; color: rgba(255, 255, 255, 0.7);">
                                Inning: ${game.inning} | Outs: ${game.outs}
                            </div>
                        </div>
                    `;
                });
                html += `</div>`;
            }

            html += `
                <button onclick="this.closest('[style*=\"position: fixed\"]').remove()" 
                    style="
                        margin-top: 20px;
                        width: 100%;
                        padding: 12px;
                        background: linear-gradient(135deg, #EF5350, #E53935);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        font-weight: bold;
                        cursor: pointer;
                        font-size: 14px;
                    ">
                    ‚ùå Cerrar
                </button>
            `;

            modal.innerHTML = html;
            overlay.appendChild(modal);
            document.body.appendChild(overlay);

            // Cerrar al hacer clic fuera del modal
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.remove();
                }
            });
        }

        // ================================================
        // CARGAR PARTIDA ESPEC√çFICA
        // ================================================
        async function cargarPartida(gameId) {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Debes iniciar sesi√≥n');
                    return;
                }

                const response = await fetch(`http://localhost:3000/api/games/${gameId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (!response.ok) {
                    alert(`‚ùå Error: ${data.error}`);
                    return;
                }

                const game = data.game;

                // Restaurar estado del juego en script_new.js
                if (typeof window.restaurarEstadoJuego === 'function') {
                    window.restaurarEstadoJuego(game);
                } else {
                    // Restauraci√≥n b√°sica si no existe la funci√≥n
                    window.homeTeam = game.home_team;
                    window.awayTeam = game.away_team;
                    window.homeScore = game.home_score;
                    window.awayScore = game.away_score;
                    window.inning = game.inning;
                    window.isTopInning = game.is_top_inning === 1;
                    window.outs = game.outs;
                    window.bases = game.bases || [false, false, false];

                    // Restaurar game_state si existe
                    if (game.game_state) {
                        window.strikes = game.game_state.strikes || 0;
                        window.balls = game.game_state.balls || 0;
                        window.currentBatter = game.game_state.currentBatter || null;
                        window.currentPitcher = game.game_state.currentPitcher || null;
                    }

                    // Actualizar UI manualmente
                    alert('‚ö†Ô∏è Partida cargada. Por favor, actualiza la interfaz seg√∫n el estado del juego.');
                }

                // Cerrar modal
                const modal = document.querySelector('[style*="position: fixed"]');
                if (modal) modal.remove();

                alert('‚úÖ Partida cargada correctamente');
            } catch (error) {
                console.error('Error al cargar partida:', error);
                alert('‚ùå Error al cargar la partida');
            }
        }

        // ================================================
        // SISTEMA DE VENTANAS FLOTANTES ARRASTRABLES
        // ================================================

        // Hacer las ventanas arrastrables
        function makeDraggable() {
            const windows = document.querySelectorAll('.floating-window');

            windows.forEach(win => {
                const header = win.querySelector('.window-header');
                let isDragging = false;
                let currentX, currentY, initialX, initialY;

                header.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    initialX = e.clientX - win.offsetLeft;
                    initialY = e.clientY - win.offsetTop;
                    win.style.zIndex = 2000; // Traer al frente
                });

                document.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        e.preventDefault();
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;
                        win.style.left = currentX + 'px';
                        win.style.top = currentY + 'px';
                    }
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
            });
        }

        // Minimizar ventana
        function minimizeWindow(windowId) {
            const win = document.getElementById(windowId);
            const content = win.querySelector('.window-content');
            if (content.style.display === 'none') {
                content.style.display = 'block';
            } else {
                content.style.display = 'none';
            }
        }

        // Cerrar ventana (solo la oculta)
        function closeWindow(windowId) {
            const win = document.getElementById(windowId);
            win.style.display = 'none';
        }

        // Abrir ventana
        function openWindow(windowId) {
            const win = document.getElementById(windowId);
            win.style.display = 'block';
            win.style.zIndex = 2000;
        }

        // Funciones de compatibilidad con botones antiguos
        function toggleChat() {
            const win = document.getElementById('chatWindow');
            if (!win) {
                console.error('chatWindow no encontrado');
                return;
            }
            if (win.style.display === 'none') {
                openWindow('chatWindow');
            } else {
                closeWindow('chatWindow');
            }
        }

        function toggleHall() {
            const win = document.getElementById('hallWindow');
            if (!win) {
                console.error('hallWindow no encontrado');
                return;
            }
            if (win.style.display === 'none') {
                openWindow('hallWindow');
                cargarHallOfFame();
            } else {
                closeWindow('hallWindow');
            }
        }

        function toggleAudioModal() {
            const win = document.getElementById('audioWindow');
            if (!win) {
                console.error('audioWindow no encontrado');
                return;
            }
            if (win.style.display === 'none') {
                openWindow('audioWindow');
            } else {
                closeWindow('audioWindow');
            }
        }

        // Inicializar sistema de ventanas al cargar
        document.addEventListener('DOMContentLoaded', () => {
            makeDraggable();
            console.log('Sistema de ventanas arrastrables inicializado');
        });

        // ================================================
        // CARGAR HALL OF FAME
        // ================================================
        async function cargarHallOfFame() {
            try {
                const container = document.getElementById('hallOfFameContent');

                if (!container) {
                    console.warn('Hall of Fame container no encontrado');
                    return;
                }

                const response = await fetch('http://localhost:3000/api/games/hall-of-fame?limit=10');

                if (!response.ok) {
                    container.innerHTML = '<div class="hall-loading">Ranking no disponible</div>';
                    return;
                }

                const data = await response.json();

                if (!data.ranking || data.ranking.length === 0) {
                    container.innerHTML = '<div class="hall-loading">No hay datos a√∫n</div>';
                    return;
                }

                // Crear tabla de rankings
                let html = `
                    <table class="ranking-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Jugador</th>
                                <th>Partidos</th>
                                <th>Ganados</th>
                                <th>Perdidos</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                data.ranking.forEach((player, index) => {
                    const rankClass = index < 3 ? `rank-${index + 1}` : '';
                    const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}¬∞`;

                    html += `
                        <tr>
                            <td class="rank-medal ${rankClass}">${medal}</td>
                            <td class="player-alias">${player.alias}</td>
                            <td class="stat-games">${player.partidos_jugados}</td>
                            <td class="stat-wins">${player.ganados}</td>
                            <td class="stat-losses">${player.perdidos}</td>
                        </tr>
                    `;
                });

                html += `
                        </tbody>
                    </table>
                `;

                container.innerHTML = html;
            } catch (error) {
                console.error('Error al cargar Hall of Fame:', error);
                const container = document.getElementById('hallOfFameContent');
                if (container) {
                    container.innerHTML = '<div class="hall-loading">Ranking no disponible</div>';
                }
            }
        }
    </script>

    <!-- ================================================ -->
    <!-- MODAL: SUBIR FOTO DE JUGADOR -->
    <!-- ================================================ -->
    <div id="playerPhotoModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 999999; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%; position: relative; z-index: 1000000;">
            <h2 style="margin-top: 0; color: #1e3c72;">üì∑ Foto del Jugador</h2>

            <input type="file" id="playerPhotoInput" accept="image/*" style="display: none;">

            <div id="photoPreviewContainer" style="text-align: center; margin: 20px 0;">
                <div id="photoPreview" style="width: 150px; height: 150px; border-radius: 50%; background: #f0f0f0; margin: 0 auto; overflow: hidden; border: 3px solid #1e3c72; display: flex; align-items: center; justify-content: center; font-size: 48px;">
                    üì∑
                </div>
            </div>

            <canvas id="photoCanvas" style="display: none;"></canvas>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button type="button" id="btn-examinar-foto" style="flex: 1; padding: 12px; background: #4FC3F7; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                    üìÅ Examinar
                </button>
                <button type="button" id="btn-guardar-foto" style="flex: 1; padding: 12px; background: #66BB6A; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                    ‚úÖ Guardar
                </button>
                <button type="button" id="btn-cancelar-foto" style="flex: 1; padding: 12px; background: #EF5350; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                    ‚ùå Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- ================================================ -->
    <!-- FUNCI√ìN: CARGAR EQUIPO AL JUEGO -->
    <!-- ================================================ -->
    <script>
        async function cargarEquipoAlJuego() {
            try {
                const teamName = document.getElementById('team-name').value.trim();
                if (!teamName) {
                    alert('Por favor ingresa un nombre para el equipo antes de cargarlo');
                    return;
                }

                // Recopilar jugadores desde el modal
                const players = [];

                // Titulares
                document.querySelectorAll('#modal-roster-table tr[data-player-id]').forEach(row => {
                    const photoCell = row.querySelector('.player-photo');
                    const photoUrl = photoCell.dataset.photoUrl || null;
                    console.log('üì∏ Recopilando jugador:', row.querySelector('.player-name').textContent, 'Foto:', photoUrl);

                    players.push({
                        number: row.querySelector('.player-number').textContent,
                        name: row.querySelector('.player-name').textContent,
                        position: row.querySelector('.position-select').value,
                        handedness: row.querySelector('.handedness-select').value,
                        avg: row.querySelector('.batting-avg').textContent,
                        obp: row.querySelector('.on-base-pct').textContent,
                        trait: row.querySelector('.trait-select').value,
                        photoUrl: photoUrl
                    });
                });

                // Banquillo
                document.querySelectorAll('#modal-bench-table tr[data-player-id]').forEach(row => {
                    const photoCell = row.querySelector('.player-photo');
                    players.push({
                        number: row.querySelector('.player-number').textContent,
                        name: row.querySelector('.player-name').textContent,
                        position: row.querySelector('.position-select').value,
                        handedness: row.querySelector('.handedness-select').value,
                        avg: row.querySelector('.batting-avg').textContent,
                        obp: row.querySelector('.on-base-pct').textContent,
                        trait: row.querySelector('.trait-select').value,
                        photoUrl: photoCell.dataset.photoUrl || null
                    });
                });

                if (players.length < 9) {
                    alert('El equipo debe tener al menos 9 jugadores');
                    return;
                }

                // GUARDAR AUTOM√ÅTICAMENTE EN LA BASE DE DATOS
                const token = localStorage.getItem('token');
                if (token) {
                    try {
                        // Verificar si estamos editando o creando nuevo
                        const isEditing = editingTeamId !== null;
                        const url = isEditing ?
                            `http://localhost:3000/api/teams/${editingTeamId}` :
                            'http://localhost:3000/api/teams';
                        const method = isEditing ? 'PUT' : 'POST';

                        const saveResponse = await fetch(url, {
                            method: method,
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            body: JSON.stringify({
                                teamName: teamName,
                                players: players
                            })
                        });

                        if (saveResponse.ok) {
                            console.log(`‚úÖ Equipo "${teamName}" guardado en Mis Equipos`);
                            cargarMisEquipos(); // Actualizar la lista
                        }
                    } catch (error) {
                        console.warn('No se pudo guardar el equipo autom√°ticamente:', error);
                    }
                }

                // Cargar en el roster correcto seg√∫n targetTeam
                console.log(`üìã Cargando equipo en: ${targetTeam}`);
                const table = document.getElementById(`roster-${targetTeam}`);
                const benchTable = document.getElementById(`bench-table-${targetTeam}`);

                console.log(`‚úÖ Tabla encontrada:`, table ? 'S√≠' : 'No');
                console.log(`‚úÖ Bench table encontrada:`, benchTable ? 'S√≠' : 'No');

                // Limpiar roster primero
                limpiarRoster(targetTeam);

                // Cargar titulares
                console.log('üîÑ Cargando', Math.min(9, players.length), 'titulares en tabla:', targetTeam);
                for (let i = 0; i < Math.min(9, players.length); i++) {
                    const player = players[i];
                    const row = table.querySelector(`tr[data-player-id="${i + 1}"]`);
                    if (row) {
                        row.querySelector('.player-name').textContent = player.name;
                        row.querySelector('.player-number').textContent = player.number;
                        row.querySelector('.batting-avg').textContent = player.avg;
                        row.querySelector('.on-base-pct').textContent = player.obp;
                        row.querySelector('.position-select').value = player.position;
                        row.querySelector('.handedness-select').value = player.handedness;
                        row.querySelector('.trait-select').value = player.trait;

                        const photoCell = row.querySelector('.player-photo');
                        if (player.photoUrl) {
                            console.log(`‚úÖ Cargando foto para ${player.name}:`, player.photoUrl);
                            photoCell.innerHTML = `<img src="http://localhost:3000${player.photoUrl}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">`;
                            photoCell.dataset.photoUrl = player.photoUrl;
                        } else {
                            console.log(`‚ö†Ô∏è Sin foto para ${player.name}`);
                            photoCell.innerHTML = 'üì∑';
                            photoCell.dataset.photoUrl = '';
                        }
                    }
                }

                // Cargar banquillo
                if (players.length > 9) {
                    const benchContainer = document.getElementById(`bench-container-${targetTeam}`);
                    if (benchContainer) {
                        benchContainer.style.display = 'block';
                    }

                    benchTable.innerHTML = '';
                    for (let i = 9; i < players.length; i++) {
                        const player = players[i];
                        const newRow = document.createElement('tr');
                        newRow.className = 'player-row';
                        newRow.dataset.playerId = i + 1;

                        newRow.innerHTML = `
                            <td class="drag-handle">‚ãÆ‚ãÆ</td>
                            <td class="player-number" contenteditable="true">${player.number}</td>
                            <td class="player-photo" data-photo-url="${player.photoUrl || ''}" style="cursor: pointer;">
                                ${player.photoUrl ? `<img src="http://localhost:3000${player.photoUrl}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">` : 'üì∑'}
                            </td>
                            <td class="player-name" contenteditable="true">${player.name}</td>
                            <td>
                                <select class="position-select">
                                    <option value="P" ${player.position === 'P' ? 'selected' : ''}>P</option>
                                    <option value="C" ${player.position === 'C' ? 'selected' : ''}>C</option>
                                    <option value="1B" ${player.position === '1B' ? 'selected' : ''}>1B</option>
                                    <option value="2B" ${player.position === '2B' ? 'selected' : ''}>2B</option>
                                    <option value="3B" ${player.position === '3B' ? 'selected' : ''}>3B</option>
                                    <option value="SS" ${player.position === 'SS' ? 'selected' : ''}>SS</option>
                                    <option value="LF" ${player.position === 'LF' ? 'selected' : ''}>LF</option>
                                    <option value="CF" ${player.position === 'CF' ? 'selected' : ''}>CF</option>
                                    <option value="RF" ${player.position === 'RF' ? 'selected' : ''}>RF</option>
                                </select>
                            </td>
                            <td>
                                <select class="handedness-select">
                                    <option value="R" ${player.handedness === 'R' ? 'selected' : ''}>R</option>
                                    <option value="L" ${player.handedness === 'L' ? 'selected' : ''}>L</option>
                                    <option value="S" ${player.handedness === 'S' ? 'selected' : ''}>S</option>
                                </select>
                            </td>
                            <td class="batting-avg" contenteditable="true">${player.avg}</td>
                            <td class="on-base-pct" contenteditable="true">${player.obp}</td>
                            <td>
                                <select class="trait-select">
                                    <option value="" ${!player.trait ? 'selected' : ''}>Ninguno</option>
                                    <option value="HR" ${player.trait === 'HR' ? 'selected' : ''}>HR</option>
                                    <option value="TB" ${player.trait === 'TB' ? 'selected' : ''}>TB</option>
                                    <option value="K" ${player.trait === 'K' ? 'selected' : ''}>K</option>
                                    <option value="BB" ${player.trait === 'BB' ? 'selected' : ''}>BB</option>
                                </select>
                            </td>
                            <td class="estado">üîµ</td>
                        `;
                        benchTable.appendChild(newRow);
                    }
                }

                closeTeamConfig();
                
                // Actualizar el nombre del equipo en el header
                const teamNameElement = document.getElementById(`team-name-${targetTeam}`);
                const headerTitle = document.getElementById(`header-title-${targetTeam}`);
                
                if (teamNameElement) {
                    teamNameElement.textContent = teamName;
                    teamNameElement.style.display = 'block';
                }
                
                if (headerTitle) {
                    headerTitle.style.fontSize = '12px';
                    headerTitle.style.opacity = '0.6';
                }
                
                const teamLabel = targetTeam === 'local' ? 'üè† Local' : '‚úàÔ∏è Visitante';
                alert(`‚úÖ Equipo "${teamName}" cargado en el equipo ${teamLabel}. ¬°Listo para jugar!`);
            } catch (error) {
                console.error('Error al cargar equipo:', error);
                alert('‚ùå Error al cargar el equipo');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOMContentLoaded ejecutado');
            // Limpiar cualquier overlay o modal bloqueante al cargar
            document.querySelectorAll('[style*="position: fixed"]').forEach(el => {
                if (el.id !== 'team-config-modal' && el.id !== 'manage-teams-modal' && el.id !== 'playerPhotoModal') {
                    el.remove();
                }
            });
            const oldOverlay = document.getElementById('games-modal-overlay');
            if (oldOverlay) oldOverlay.remove();

            // Crear ventanas flotantes (Chat, Hall, Audio)
            createFloatingWindows();

            // Inicializar sistema de audio
            if (typeof AudioSystem !== 'undefined') {
                AudioSystem.init();
                console.log('üéµ Sistema de audio inicializado');
            }

            document.querySelectorAll('.player-photo').forEach(cell => {
                cell.style.cursor = 'pointer';
                cell.title = 'Click para cambiar foto';
                cell.addEventListener('click', function() {
                    const row = this.closest('tr');
                    const playerId = row.dataset.playerId;
                    const table = this.closest('table');
                    const team = table.id.replace('roster-', '');
                    openPhotoModal(playerId, team);
                });
            });
        });

        // Crear ventanas flotantes
        function createFloatingWindows() {
            console.log('üì¶ Creando ventanas flotantes...');

            // Ventana de Audio
            const audioWindow = document.createElement('div');
            audioWindow.id = 'audioWindow';
            audioWindow.style.cssText = 'display: none; position: fixed; top: 100px; right: 20px; width: 350px; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); z-index: 999999;';
            audioWindow.innerHTML = `
                <div style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; padding: 12px 15px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-weight: bold;">üéµ Control de Audio</span>
                    <button onclick="closeWindow('audioWindow')" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer;">√ó</button>
                </div>
                <div style="padding: 20px;">
                    <div style="margin-bottom: 15px; display: flex; gap: 10px;">
                        <button id="playMusicBtn" style="background: #10b981; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; flex: 1;">‚ñ∂Ô∏è Play</button>
                        <button id="pauseMusicBtn" style="background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; flex: 1;">‚è∏Ô∏è Pause</button>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-size: 14px; color: #555;">üéµ M√∫sica:</label>
                        <input type="range" id="music-volume" min="0" max="100" value="30" style="width: 100%;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 14px; color: #555;">üîî Efectos:</label>
                        <input type="range" id="sfx-volume" min="0" max="100" value="50" style="width: 100%;">
                    </div>
                </div>
            `;
            document.body.appendChild(audioWindow);
            console.log('‚úÖ Ventana de audio creada');

            // Agregar event listeners despu√©s de crear el DOM
            setTimeout(() => {
                console.log('üîß Agregando event listeners...');
                const playBtn = document.getElementById('playMusicBtn');
                const pauseBtn = document.getElementById('pauseMusicBtn');
                const musicVolume = document.getElementById('music-volume');

                console.log('üîç playBtn:', !!playBtn, 'pauseBtn:', !!pauseBtn);

                if (playBtn) {
                    playBtn.addEventListener('click', function() {
                        console.log('üéµ Click en Play detectado');
                        playBackgroundMusic();
                    });
                    console.log('‚úÖ Event listener de Play agregado');
                }

                if (pauseBtn) {
                    pauseBtn.addEventListener('click', function() {
                        console.log('‚è∏Ô∏è Click en Pause detectado');
                        pauseBackgroundMusic();
                    });
                    console.log('‚úÖ Event listener de Pause agregado');
                }

                if (musicVolume) {
                    musicVolume.addEventListener('input', function() {
                        setMusicVolume(this.value);
                    });
                }
            }, 100);

            // Ventana de Chat
            const chatWindow = document.createElement('div');
            chatWindow.id = 'chatWindow';
            chatWindow.style.cssText = 'display: none; position: fixed; top: 80px; left: 20px; width: 400px; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); z-index: 999999;';
            chatWindow.innerHTML = `
                <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 12px 15px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-weight: bold;">üí¨ Chat</span>
                    <button onclick="closeWindow('chatWindow')" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer;">√ó</button>
                </div>
                <div style="padding: 0; height: 400px; display: flex; flex-direction: column;">
                    <div id="chatSidebarMessages" style="flex: 1; overflow-y: auto; padding: 15px; background: #f9fafb;">
                        <div>Cargando mensajes...</div>
                    </div>
                    <div style="padding: 15px; border-top: 1px solid #e5e7eb; background: white;">
                        <form id="chatSidebarForm" style="display: flex; gap: 10px;">
                            <input type="text" id="chatSidebarInput" placeholder="Escribe un mensaje..." maxlength="500" required style="flex: 1; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
                            <button type="submit" style="padding: 10px 15px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">üì§</button>
                        </form>
                    </div>
                </div>
            `;
            document.body.appendChild(chatWindow);

            // Ventana de Hall of Fame
            const hallWindow = document.createElement('div');
            hallWindow.id = 'hallWindow';
            hallWindow.style.cssText = 'display: none; position: fixed; top: 200px; right: 20px; width: 500px; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); z-index: 999999;';
            hallWindow.innerHTML = `
                <div style="background: linear-gradient(135deg, #fbbf24, #f59e0b); color: white; padding: 12px 15px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-weight: bold;">üèÜ Hall of Fame</span>
                    <button onclick="closeWindow('hallWindow')" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer;">√ó</button>
                </div>
                <div style="padding: 20px; max-height: 400px; overflow-y: auto;">
                    <div id="hallOfFameContent">
                        <div style="text-align: center; color: #999;">Cargando ranking...</div>
                    </div>
                    <button onclick="cargarHallOfFame()" style="width: 100%; margin-top: 15px; padding: 12px; background: #fbbf24; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">üîÑ Actualizar</button>
                </div>
            `;
            document.body.appendChild(hallWindow);

            console.log('‚úÖ Ventanas flotantes creadas');

            // Inicializar funcionalidad del chat
            initializeChatForm();
        }

        function initializeChatForm() {
            const chatForm = document.getElementById('chatSidebarForm');
            const chatInput = document.getElementById('chatSidebarInput');

            if (!chatForm || !chatInput) {
                console.warn('Formulario de chat no encontrado');
                return;
            }

            chatForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const message = chatInput.value.trim();
                if (!message) return;

                // Verificar si socket.io est√° disponible
                if (typeof io === 'undefined') {
                    alert('‚ö†Ô∏è Sistema de chat no disponible. Aseg√∫rate de que el servidor est√© corriendo.');
                    return;
                }

                // Obtener datos del usuario
                const usuario = getUsuarioActual ? getUsuarioActual() : JSON.parse(localStorage.getItem('usuario') || '{}');

                if (!usuario || !usuario.nombre) {
                    alert('‚ö†Ô∏è Debes estar logueado para usar el chat');
                    return;
                }

                // Enviar mensaje (aqu√≠ puedes integrar con socket.io)
                const chatMessages = document.getElementById('chatSidebarMessages');
                if (chatMessages) {
                    const messageDiv = document.createElement('div');
                    messageDiv.style.cssText = 'margin-bottom: 10px; padding: 8px 12px; background: #e0e7ff; border-radius: 8px;';
                    messageDiv.innerHTML = `
                        <div style="font-weight: bold; color: #4f46e5; font-size: 12px; margin-bottom: 4px;">${usuario.nombre}</div>
                        <div style="color: #374151; font-size: 14px;">${message}</div>
                        <div style="font-size: 11px; color: #9ca3af; margin-top: 4px;">${new Date().toLocaleTimeString()}</div>
                    `;
                    chatMessages.appendChild(messageDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }

                chatInput.value = '';
                chatInput.focus();
            });

            console.log('‚úÖ Chat inicializado');
        }

        function openWindow(windowId) {
            const win = document.getElementById(windowId);
            if (win) win.style.display = 'block';
        }

        function closeWindow(windowId) {
            const win = document.getElementById(windowId);
            if (win) win.style.display = 'none';
        }
    </script>

    <!-- ================================================ -->
    <!-- SCRIPT: GESTI√ìN DE EQUIPOS PERSONALIZADOS -->
    <!-- ================================================ -->
    <script>
        let currentEditingTeamId = null;

        // ================================================
        // CARGAR MIS EQUIPOS EN EL SELECTOR
        // ================================================
        async function cargarMisEquipos() {
            try {
                const token = localStorage.getItem('token');
                if (!token) return;

                const response = await fetch('http://localhost:3000/api/teams', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                const container = document.getElementById('saved-teams-container');

                if (!container) {
                    console.warn('Contenedor saved-teams-container no encontrado');
                    return;
                }

                if (!response.ok || data.equipos.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">No tienes equipos guardados a√∫n</div>';
                    return;
                }

                let html = '<div style="display: grid; gap: 10px;">';
                data.equipos.forEach(equipo => {
                    html += `
                        <div style="background: white; border: 2px solid #1e3c72; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s;" 
                             onmouseover="this.style.background='#e3f2fd'" 
                             onmouseout="this.style.background='white'"
                             onclick="cargarEquipoAlRoster(${equipo.id})">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="color: #1e3c72; font-size: 14px;">‚öæ ${equipo.teamName}</strong>
                                    <div style="font-size: 11px; color: #666; margin-top: 4px;">
                                        ${new Date(equipo.createdAt).toLocaleDateString('es-ES')}
                                    </div>
                                </div>
                                <button onclick="event.stopPropagation(); eliminarEquipoDesdeSelector(${equipo.id})" 
                                        style="background: #EF5350; color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 12px;">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';

                container.innerHTML = html;
            } catch (error) {
                console.error('Error al cargar equipos:', error);
            }
        }

        // ================================================
        // CARGAR EQUIPO AL ROSTER DEL JUEGO
        // ================================================
        async function cargarEquipoAlRoster(teamId) {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Debes iniciar sesi√≥n');
                    return;
                }

                const response = await fetch(`http://localhost:3000/api/teams/${teamId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (!response.ok) {
                    alert(`Error: ${data.error}`);
                    return;
                }

                const equipo = data.equipo;
                const teamType = currentTeamType; // 'visitante' o 'local'
                const table = document.getElementById(`roster-${teamType}`);
                const benchTable = document.getElementById(`bench-table-${teamType}`);

                // Llenar el nombre del equipo
                document.getElementById('team-name').value = equipo.teamName;

                // Llenar los primeros 9 jugadores titulares
                for (let i = 0; i < Math.min(9, equipo.players.length); i++) {
                    const player = equipo.players[i];
                    const row = table.querySelector(`tr[data-player-id="${i + 1}"]`);
                    if (row) {
                        row.querySelector('.player-name').textContent = player.name || `Jugador ${i + 1}`;
                        row.querySelector('.player-number').textContent = player.number || (i + 1);
                        row.querySelector('.batting-avg').textContent = player.avg || '.250';
                        row.querySelector('.on-base-pct').textContent = player.obp || '.300';

                        const posSelect = row.querySelector('.position-select');
                        if (posSelect) posSelect.value = player.position || 'P';

                        const handSelect = row.querySelector('.handedness-select');
                        if (handSelect) handSelect.value = player.handedness || 'R';

                        const traitSelect = row.querySelector('.trait-select');
                        if (traitSelect) traitSelect.value = player.trait || '';

                        // Cargar foto si existe
                        const photoCell = row.querySelector('.player-photo');
                        if (player.photoUrl) {
                            photoCell.innerHTML = `<img src="http://localhost:3000${player.photoUrl}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">`;
                            photoCell.dataset.photoUrl = player.photoUrl;
                        } else {
                            photoCell.innerHTML = 'üì∑';
                            photoCell.dataset.photoUrl = '';
                        }
                    }
                }

                // Cargar jugadores del banquillo (del 10 en adelante)
                if (equipo.players.length > 9) {
                    // Mostrar el banquillo si estaba oculto
                    const benchContainer = document.getElementById(`bench-container-${teamType}`);
                    if (benchContainer) {
                        benchContainer.style.display = 'block';
                    }

                    // Limpiar banquillo actual primero
                    benchTable.innerHTML = '';

                    // Cargar jugadores del banquillo
                    for (let i = 9; i < equipo.players.length; i++) {
                        const player = equipo.players[i];
                        const playerId = i + 1;

                        // Crear nueva fila de jugador del banquillo
                        const newRow = document.createElement('tr');
                        newRow.className = 'player-row';
                        newRow.draggable = true;
                        newRow.dataset.playerId = playerId;

                        newRow.innerHTML = `
                            <td class="drag-handle">‚ãÆ‚ãÆ</td>
                            <td class="player-number" contenteditable="true">${player.number || playerId}</td>
                            <td class="player-photo" data-photo-url="${player.photoUrl || ''}" style="cursor: pointer;">
                                ${player.photoUrl ? `<img src="http://localhost:3000${player.photoUrl}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">` : 'üì∑'}
                            </td>
                            <td class="player-name" contenteditable="true">${player.name || `Suplente ${i - 8}`}</td>
                            <td>
                                <select class="position-select">
                                    <option value="P" ${player.position === 'P' ? 'selected' : ''}>P</option>
                                    <option value="C" ${player.position === 'C' ? 'selected' : ''}>C</option>
                                    <option value="1B" ${player.position === '1B' ? 'selected' : ''}>1B</option>
                                    <option value="2B" ${player.position === '2B' ? 'selected' : ''}>2B</option>
                                    <option value="3B" ${player.position === '3B' ? 'selected' : ''}>3B</option>
                                    <option value="SS" ${player.position === 'SS' ? 'selected' : ''}>SS</option>
                                    <option value="LF" ${player.position === 'LF' ? 'selected' : ''}>LF</option>
                                    <option value="CF" ${player.position === 'CF' ? 'selected' : ''}>CF</option>
                                    <option value="RF" ${player.position === 'RF' ? 'selected' : ''}>RF</option>
                                </select>
                            </td>
                            <td>
                                <select class="handedness-select">
                                    <option value="R" ${player.handedness === 'R' ? 'selected' : ''}>R</option>
                                    <option value="L" ${player.handedness === 'L' ? 'selected' : ''}>L</option>
                                    <option value="S" ${player.handedness === 'S' ? 'selected' : ''}>S</option>
                                </select>
                            </td>
                            <td class="batting-avg" contenteditable="true">${player.avg || '.250'}</td>
                            <td class="on-base-pct" contenteditable="true">${player.obp || '.300'}</td>
                            <td>
                                <select class="trait-select">
                                    <option value="" ${!player.trait ? 'selected' : ''}>Ninguno</option>
                                    <option value="HR" ${player.trait === 'HR' ? 'selected' : ''}>HR</option>
                                    <option value="TB" ${player.trait === 'TB' ? 'selected' : ''}>TB</option>
                                    <option value="K" ${player.trait === 'K' ? 'selected' : ''}>K</option>
                                    <option value="BB" ${player.trait === 'BB' ? 'selected' : ''}>BB</option>
                                </select>
                            </td>
                            <td class="estado">üîµ</td>
                        `;

                        benchTable.appendChild(newRow);

                        // A√±adir evento click a la foto
                        const photoCell = newRow.querySelector('.player-photo');
                        photoCell.addEventListener('click', function() {
                            openPhotoModal(playerId, teamType);
                        });
                    }
                }

                alert(`‚úÖ Equipo "${equipo.teamName}" cargado con ${equipo.players.length} jugadores`);
                closeTeamConfig();
            } catch (error) {
                console.error('Error al cargar equipo:', error);
                alert('‚ùå Error al cargar el equipo');
            }
        }

        // ================================================
        // VER GESTI√ìN DE EQUIPOS
        // ================================================
        function verGestionEquipos() {
            closeTeamConfig();
            document.getElementById('manage-teams-modal').style.display = 'flex';
            cargarEquiposGuardados();
        }

        function cerrarGestionEquipos() {
            document.getElementById('manage-teams-modal').style.display = 'none';
        }

        // ================================================
        // CARGAR EQUIPOS GUARDADOS EN EL MODAL
        // ================================================
        async function cargarEquiposGuardados() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Debes iniciar sesi√≥n');
                    return;
                }

                const response = await fetch('http://localhost:3000/api/teams', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                const container = document.getElementById('saved-teams-container');

                if (!response.ok || data.equipos.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #999; padding: 40px; border: 2px dashed #ddd; border-radius: 8px;"><p style="font-size: 48px; margin: 0;">‚öæ</p><p>No tienes equipos guardados</p><p style="font-size: 14px; color: #999;">Haz click en "Crear Nuevo Equipo" para empezar</p></div>';
                    return;
                }

                let html = '';
                data.equipos.forEach(equipo => {
                    html += `
                        <div style="background: linear-gradient(135deg, #f5f5f5, #ffffff); border: 2px solid #1e3c72; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                <div>
                                    <h4 style="margin: 0; color: #1e3c72; font-size: 18px;">‚öæ ${equipo.teamName}</h4>
                                    <p style="margin: 5px 0 0 0; font-size: 12px; color: #666;">
                                        Creado: ${new Date(equipo.createdAt).toLocaleDateString('es-ES')}
                                    </p>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <button onclick="editarEquipo(${equipo.id})" style="background: #4FC3F7; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                                        ‚úèÔ∏è Editar
                                    </button>
                                    <button onclick="eliminarEquipo(${equipo.id})" style="background: #EF5350; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                                        üóëÔ∏è Eliminar
                                    </button>
                                </div>
                            </div>
                            <div style="background: white; border-radius: 8px; padding: 12px; max-height: 150px; overflow-y: auto;">
                                <strong style="color: #1e3c72; font-size: 13px;">Jugadores:</strong>
                                <ol style="margin: 8px 0 0 0; padding-left: 20px; font-size: 12px; color: #555;">
                                    ${equipo.players.slice(0, 9).map(p => `<li>${p.name || 'Sin nombre'} (${p.position || 'N/A'})</li>`).join('')}
                                </ol>
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;
            } catch (error) {
                console.error('Error al cargar equipos:', error);
                alert('‚ùå Error al cargar equipos');
            }
        }

        // Variable global para saber si estamos editando un equipo existente
        let editingTeamId = null;
        // Variable global para saber a qu√© equipo cargar (local o visitante)
        let targetTeam = 'local';

        // ================================================
        // ABRIR CONFIGURACI√ìN DE EQUIPO
        // ================================================
        function openTeamConfig(team) {
            targetTeam = team; // Guardar local o visitante
            editingTeamId = null; // Resetear ID de edici√≥n
            currentTeamType = 'custom';
            document.getElementById('team-config-modal').style.display = 'flex';
            document.getElementById('modal-title').textContent = `‚ûï Configurar Equipo ${team === 'local' ? 'üè† Local' : '‚úàÔ∏è Visitante'}`;
            document.getElementById('team-name').value = '';
            
            // Limpiar roster del equipo correspondiente
            limpiarRoster(team);
        }

        // CREAR NUEVO EQUIPO
        function crearNuevoEquipo() {
            editingTeamId = null; // Resetear ID de edici√≥n
            targetTeam = 'local'; // Por defecto al local cuando se crea desde Mis Equipos
            cerrarGestionEquipos();
            // Limpiar roster antes de crear nuevo
            limpiarRoster('local');
            // Abrir el modal de configuraci√≥n para crear un equipo nuevo
            currentTeamType = 'custom'; // Marcar que es personalizado
            document.getElementById('team-config-modal').style.display = 'flex';
            document.getElementById('modal-title').textContent = '‚ûï Crear Nuevo Equipo';
            document.getElementById('team-name').value = '';
        }

        // EDITAR EQUIPO EXISTENTE
        async function editarEquipo(teamId) {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Debes iniciar sesi√≥n');
                    return;
                }

                const response = await fetch(`http://localhost:3000/api/teams/${teamId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (!response.ok) {
                    alert(`Error: ${data.error}`);
                    return;
                }

                const equipo = data.equipo;
                editingTeamId = teamId;
                
                cerrarGestionEquipos();
                
                // Abrir modal
                document.getElementById('team-config-modal').style.display = 'flex';
                document.getElementById('modal-title').textContent = `‚úèÔ∏è Editar: ${equipo.teamName}`;
                document.getElementById('team-name').value = equipo.teamName;

                // Usar tabla ID√âNTICA al roster
                const playersEditor = document.getElementById('players-editor');
                playersEditor.innerHTML = `
                    <div class="roster-container" style="max-height: 500px; overflow-y: auto;">
                        <h4 style="margin: 0 0 10px 0; color: #1e3c72;">‚öæ Jugadores Titulares</h4>
                        <table class="roster-table" id="modal-roster-table">
                            <thead>
                                <tr>
                                    <th>Handle</th>
                                    <th>#</th>
                                    <th>Foto</th>
                                    <th>Nombre</th>
                                    <th>Posici√≥n</th>
                                    <th>Mano</th>
                                    <th>AVG</th>
                                    <th>OBP</th>
                                    <th>Traits</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        
                        ${equipo.players.length > 9 ? `
                            <h4 style="margin: 20px 0 10px 0; color: #475569;">ü™ë Banquillo</h4>
                            <table class="roster-table" id="modal-bench-table">
                                <thead>
                                    <tr>
                                        <th>Handle</th>
                                        <th>#</th>
                                        <th>Foto</th>
                                        <th>Nombre</th>
                                        <th>Posici√≥n</th>
                                        <th>Mano</th>
                                        <th>AVG</th>
                                        <th>OBP</th>
                                        <th>Traits</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        ` : ''}
                    </div>
                `;

                // Llenar titulares
                const rosterTbody = document.querySelector('#modal-roster-table tbody');
                for (let i = 0; i < Math.min(9, equipo.players.length); i++) {
                    const player = equipo.players[i];
                    const row = document.createElement('tr');
                    row.className = 'player-row';
                    row.setAttribute('draggable', 'true');
                    row.dataset.playerId = i + 1;
                    
                    const photoHtml = player.photoUrl 
                        ? `<img src="http://localhost:3000${player.photoUrl}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">`
                        : 'üì∑';
                    
                    row.innerHTML = `
                        <td class="drag-handle">‚ãÆ‚ãÆ</td>
                        <td class="player-number" contenteditable="true">${player.number || (i + 1)}</td>
                        <td class="player-photo" data-photo-url="${player.photoUrl || ''}" style="cursor: pointer;">${photoHtml}</td>
                        <td class="player-name" contenteditable="true">${player.name || `Jugador ${i + 1}`}</td>
                        <td>
                            <select class="position-select">
                                <option value="P" ${player.position === 'P' ? 'selected' : ''}>P</option>
                                <option value="C" ${player.position === 'C' ? 'selected' : ''}>C</option>
                                <option value="1B" ${player.position === '1B' ? 'selected' : ''}>1B</option>
                                <option value="2B" ${player.position === '2B' ? 'selected' : ''}>2B</option>
                                <option value="3B" ${player.position === '3B' ? 'selected' : ''}>3B</option>
                                <option value="SS" ${player.position === 'SS' ? 'selected' : ''}>SS</option>
                                <option value="LF" ${player.position === 'LF' ? 'selected' : ''}>LF</option>
                                <option value="CF" ${player.position === 'CF' ? 'selected' : ''}>CF</option>
                                <option value="RF" ${player.position === 'RF' ? 'selected' : ''}>RF</option>
                                <option value="DH" ${player.position === 'DH' ? 'selected' : ''}>DH</option>
                            </select>
                        </td>
                        <td>
                            <select class="handedness-select">
                                <option value="R" ${player.handedness === 'R' ? 'selected' : ''}>R</option>
                                <option value="L" ${player.handedness === 'L' ? 'selected' : ''}>L</option>
                                <option value="S" ${player.handedness === 'S' ? 'selected' : ''}>S</option>
                            </select>
                        </td>
                        <td class="batting-avg" contenteditable="true">${player.avg || '.250'}</td>
                        <td class="on-base-pct" contenteditable="true">${player.obp || '.300'}</td>
                        <td>
                            <select class="trait-select">
                                <option value="" ${!player.trait ? 'selected' : ''}>-</option>
                                <option value="P+" ${player.trait === 'P+' ? 'selected' : ''}>P+</option>
                                <option value="P++" ${player.trait === 'P++' ? 'selected' : ''}>P++</option>
                                <option value="C+" ${player.trait === 'C+' ? 'selected' : ''}>C+</option>
                                <option value="S+" ${player.trait === 'S+' ? 'selected' : ''}>S+</option>
                                <option value="D+" ${player.trait === 'D+' ? 'selected' : ''}>D+</option>
                                <option value="T+" ${player.trait === 'T+' ? 'selected' : ''}>T+</option>
                                <option value="P-" ${player.trait === 'P-' ? 'selected' : ''}>P-</option>
                                <option value="P--" ${player.trait === 'P--' ? 'selected' : ''}>P--</option>
                                <option value="C" ${player.trait === 'C' ? 'selected' : ''}>C</option>
                                <option value="S-" ${player.trait === 'S-' ? 'selected' : ''}>S-</option>
                                <option value="D-" ${player.trait === 'D-' ? 'selected' : ''}>D-</option>
                                <option value="K+" ${player.trait === 'K+' ? 'selected' : ''}>K+</option>
                                <option value="GB+" ${player.trait === 'GB+' ? 'selected' : ''}>GB+</option>
                                <option value="CN+" ${player.trait === 'CN+' ? 'selected' : ''}>CN+</option>
                                <option value="ST+" ${player.trait === 'ST+' ? 'selected' : ''}>ST+</option>
                                <option value="CN-" ${player.trait === 'CN-' ? 'selected' : ''}>CN-</option>
                            </select>
                        </td>
                    `;
                    rosterTbody.appendChild(row);
                }

                // Llenar banquillo si hay
                if (equipo.players.length > 9) {
                    const benchTbody = document.querySelector('#modal-bench-table tbody');
                    for (let i = 9; i < equipo.players.length; i++) {
                        const player = equipo.players[i];
                        const row = document.createElement('tr');
                        row.className = 'player-row';
                        row.setAttribute('draggable', 'true');
                        row.dataset.playerId = i + 1;
                        
                        const photoHtml = player.photoUrl 
                            ? `<img src="http://localhost:3000${player.photoUrl}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">`
                            : 'üì∑';
                        
                        row.innerHTML = `
                            <td class="drag-handle">‚ãÆ‚ãÆ</td>
                            <td class="player-number" contenteditable="true">${player.number || (i + 1)}</td>
                            <td class="player-photo" data-photo-url="${player.photoUrl || ''}" style="cursor: pointer;">${photoHtml}</td>
                            <td class="player-name" contenteditable="true">${player.name || `Suplente ${i - 8}`}</td>
                            <td>
                                <select class="position-select">
                                    <option value="P" ${player.position === 'P' ? 'selected' : ''}>P</option>
                                    <option value="C" ${player.position === 'C' ? 'selected' : ''}>C</option>
                                    <option value="1B" ${player.position === '1B' ? 'selected' : ''}>1B</option>
                                    <option value="2B" ${player.position === '2B' ? 'selected' : ''}>2B</option>
                                    <option value="3B" ${player.position === '3B' ? 'selected' : ''}>3B</option>
                                    <option value="SS" ${player.position === 'SS' ? 'selected' : ''}>SS</option>
                                    <option value="LF" ${player.position === 'LF' ? 'selected' : ''}>LF</option>
                                    <option value="CF" ${player.position === 'CF' ? 'selected' : ''}>CF</option>
                                    <option value="RF" ${player.position === 'RF' ? 'selected' : ''}>RF</option>
                                    <option value="DH" ${player.position === 'DH' ? 'selected' : ''}>DH</option>
                                </select>
                            </td>
                            <td>
                                <select class="handedness-select">
                                    <option value="R" ${player.handedness === 'R' ? 'selected' : ''}>R</option>
                                    <option value="L" ${player.handedness === 'L' ? 'selected' : ''}>L</option>
                                    <option value="S" ${player.handedness === 'S' ? 'selected' : ''}>S</option>
                                </select>
                            </td>
                            <td class="batting-avg" contenteditable="true">${player.avg || '.250'}</td>
                            <td class="on-base-pct" contenteditable="true">${player.obp || '.300'}</td>
                            <td>
                                <select class="trait-select">
                                    <option value="" ${!player.trait ? 'selected' : ''}>-</option>
                                    <option value="P+" ${player.trait === 'P+' ? 'selected' : ''}>P+</option>
                                    <option value="P++" ${player.trait === 'P++' ? 'selected' : ''}>P++</option>
                                    <option value="C+" ${player.trait === 'C+' ? 'selected' : ''}>C+</option>
                                    <option value="S+" ${player.trait === 'S+' ? 'selected' : ''}>S+</option>
                                    <option value="D+" ${player.trait === 'D+' ? 'selected' : ''}>D+</option>
                                    <option value="T+" ${player.trait === 'T+' ? 'selected' : ''}>T+</option>
                                    <option value="P-" ${player.trait === 'P-' ? 'selected' : ''}>P-</option>
                                    <option value="P--" ${player.trait === 'P--' ? 'selected' : ''}>P--</option>
                                    <option value="C" ${player.trait === 'C' ? 'selected' : ''}>C</option>
                                    <option value="S-" ${player.trait === 'S-' ? 'selected' : ''}>S-</option>
                                    <option value="D-" ${player.trait === 'D-' ? 'selected' : ''}>D-</option>
                                    <option value="K+" ${player.trait === 'K+' ? 'selected' : ''}>K+</option>
                                    <option value="GB+" ${player.trait === 'GB+' ? 'selected' : ''}>GB+</option>
                                    <option value="CN+" ${player.trait === 'CN+' ? 'selected' : ''}>CN+</option>
                                    <option value="ST+" ${player.trait === 'ST+' ? 'selected' : ''}>ST+</option>
                                    <option value="CN-" ${player.trait === 'CN-' ? 'selected' : ''}>CN-</option>
                                </select>
                            </td>
                        `;
                        benchTbody.appendChild(row);
                    }
                }

                // Event listeners para fotos
                setTimeout(() => {
                    document.querySelectorAll('#modal-roster-table .player-photo, #modal-bench-table .player-photo').forEach(photoCell => {
                        photoCell.addEventListener('click', function() {
                            const row = this.closest('tr');
                            const playerId = row.dataset.playerId;
                            console.log('üì∏ [MODAL] Abriendo foto - Jugador:', playerId, 'Equipo:', targetTeam);
                            openPhotoModal(playerId, targetTeam);
                        });
                    });
                }, 100);

            } catch (error) {
                console.error('Error al cargar equipo:', error);
                alert('‚ùå Error al cargar el equipo');
            }
        }

        // Funci√≥n para limpiar un roster
        function limpiarRoster(teamType) {
            const table = document.getElementById(`roster-${teamType}`);
            const benchTable = document.getElementById(`bench-table-${teamType}`);
            
            // Limpiar roster principal (9 jugadores)
            for (let i = 1; i <= 9; i++) {
                const row = table.querySelector(`tr[data-player-id="${i}"]`);
                if (row) {
                    row.querySelector('.player-name').textContent = `Jugador ${i}`;
                    row.querySelector('.player-number').textContent = i;
                    row.querySelector('.batting-avg').textContent = '.250';
                    row.querySelector('.on-base-pct').textContent = '.300';
                    row.querySelector('.position-select').value = 'P';
                    row.querySelector('.handedness-select').value = 'R';
                    row.querySelector('.trait-select').value = '';
                    
                    const photoCell = row.querySelector('.player-photo');
                    photoCell.innerHTML = 'üì∑';
                    photoCell.dataset.photoUrl = '';
                }
            }
            
            // Limpiar banquillo
            if (benchTable) {
                benchTable.innerHTML = '';
            }
        }

        // GUARDAR EQUIPO COMO PERSONALIZADO
        async function guardarEquipoPersonalizado() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Debes iniciar sesi√≥n para guardar equipos');
                    return;
                }

                const teamName = document.getElementById('team-name').value.trim();
                if (!teamName) {
                    alert('Por favor ingresa un nombre para el equipo');
                    return;
                }

                const players = [];

                // SIEMPRE leer desde las tablas del modal cuando estamos en el modal de configuraci√≥n
                // Titulares desde el modal
                document.querySelectorAll('#modal-roster-table tr[data-player-id]').forEach(row => {
                    const photoCell = row.querySelector('.player-photo');
                    const playerName = row.querySelector('.player-name').textContent.trim();
                    
                    if (playerName) {
                        players.push({
                            number: row.querySelector('.player-number').textContent,
                            name: playerName,
                            position: row.querySelector('.position-select').value,
                            handedness: row.querySelector('.handedness-select').value,
                            avg: row.querySelector('.batting-avg').textContent,
                            obp: row.querySelector('.on-base-pct').textContent,
                            trait: row.querySelector('.trait-select').value,
                            photoUrl: photoCell.dataset.photoUrl || null
                        });
                    }
                });

                // Banquillo desde el modal
                document.querySelectorAll('#modal-bench-table tr[data-player-id]').forEach(row => {
                    const photoCell = row.querySelector('.player-photo');
                    const playerName = row.querySelector('.player-name').textContent.trim();
                    if (playerName) {
                        players.push({
                            number: row.querySelector('.player-number').textContent,
                            name: playerName,
                            position: row.querySelector('.position-select').value,
                            handedness: row.querySelector('.handedness-select').value,
                            avg: row.querySelector('.batting-avg').textContent,
                            obp: row.querySelector('.on-base-pct').textContent,
                            trait: row.querySelector('.trait-select').value,
                            photoUrl: photoCell.dataset.photoUrl || null
                        });
                    }
                });

                // Si no hay jugadores en las tablas del modal, intentar leer desde las tarjetas MLB
                if (players.length === 0) {
                    console.log('No se encontraron jugadores en las tablas del modal, buscando en player-cards...');
                    document.querySelectorAll('.player-card').forEach((card, index) => {
                        const nameInput = card.querySelector('.player-name-input');
                        const numberSpan = card.querySelector('.player-number');
                        const posSelect = card.querySelector('.player-pos-select');
                        const handSelect = card.querySelector('.player-hand-select');
                        const avgInput = card.querySelector('.player-avg-input');
                        const obpInput = card.querySelector('.player-obp-input');
                        const traitSelect = card.querySelector('.player-trait-select');

                        if (nameInput && nameInput.value.trim()) {
                            players.push({
                                number: numberSpan ? numberSpan.textContent.replace('#', '') : String(index + 1),
                                name: nameInput.value.trim(),
                                position: posSelect ? posSelect.value : 'P',
                                handedness: handSelect ? handSelect.value : 'R',
                                avg: avgInput ? avgInput.value : '.250',
                                obp: obpInput ? obpInput.value : '.300',
                                trait: traitSelect ? traitSelect.value : '',
                                photoUrl: null
                            });
                        }
                    });
                }

                console.log('Jugadores recopilados:', players.length);

                // Verificar que tenemos al menos 9 jugadores titulares
                if (players.length < 9) {
                    alert(`Error: Solo se encontraron ${players.length} jugadores titulares. Se necesitan al menos 9.`);
                    return;
                }

                console.log('Total de jugadores (titulares + banquillo):', players.length);

                // Determinar si estamos creando o actualizando
                const isEditing = editingTeamId !== null;
                const url = isEditing ? `http://localhost:3000/api/teams/${editingTeamId}` : 'http://localhost:3000/api/teams';
                const method = isEditing ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        teamName: teamName,
                        players: players
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    const accion = isEditing ? 'actualizado' : 'guardado';
                    alert(`‚úÖ Equipo "${teamName}" ${accion} con ${players.length} jugadores (9 titulares + ${players.length - 9} banquillo)`);
                    editingTeamId = null; // Resetear despu√©s de guardar
                    cargarMisEquipos(); // Actualizar lista
                    cargarEquiposGuardados(); // Actualizar modal de gesti√≥n
                    closeTeamConfig();
                } else {
                    alert(`‚ùå Error: ${data.error}`);
                }
            } catch (error) {
                console.error('Error al guardar equipo:', error);
                alert('‚ùå Error al guardar el equipo');
            }
        }

        // ================================================
        // ELIMINAR EQUIPO
        // ================================================
        async function eliminarEquipo(teamId) {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar este equipo?')) {
                return;
            }

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`http://localhost:3000/api/teams/${teamId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    alert('‚úÖ Equipo eliminado');
                    cargarEquiposGuardados();
                    cargarMisEquipos();
                } else {
                    alert(`‚ùå Error: ${data.error}`);
                }
            } catch (error) {
                console.error('Error al eliminar:', error);
                alert('‚ùå Error al eliminar el equipo');
            }
        }

        function eliminarEquipoDesdeSelector(teamId) {
            eliminarEquipo(teamId);
        }

        // ================================================
        // CARGAR MIS EQUIPOS AL INICIO
        // ================================================
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar mis equipos al inicio
            cargarMisEquipos();
        });
    </script>

    <!-- Inicializaci√≥n de Audio (forzada al final) -->
    <script>
        // Sistema de audio simplificado
        let musicPlayer = null;

        function playBackgroundMusic() {
            console.log('‚ñ∂Ô∏è Intentando reproducir m√∫sica...');
            if (!musicPlayer) {
                musicPlayer = new Audio('audio/background.mp3');
                musicPlayer.loop = true;
                musicPlayer.volume = 0.3;
                console.log('üéµ Audio creado:', musicPlayer.src);
            }

            musicPlayer.play()
                .then(() => {
                    console.log('‚úÖ M√∫sica reproduciendo');
                })
                .catch(error => {
                    console.error('‚ùå Error al reproducir:', error);
                    alert('Error: ' + error.message);
                });
        }

        function pauseBackgroundMusic() {
            console.log('‚è∏Ô∏è Pausando m√∫sica...');
            if (musicPlayer) {
                musicPlayer.pause();
                console.log('‚úÖ M√∫sica pausada');
            }
        }

        function setMusicVolume(value) {
            if (musicPlayer) {
                musicPlayer.volume = value / 100;
                console.log('üîä Volumen ajustado a:', value);
            }
        }
    </script>

    <!-- FOTOS DE JUGADORES - INICIALIZACI√ìN -->
    <script>
        console.log('üé¨ Inicializando input de fotos...');

        // Procesar imagen cuando se selecciona
        const photoInput = document.getElementById('playerPhotoInput');
        if (photoInput) {
            photoInput.addEventListener('change', function(e) {
                console.log('üñºÔ∏è Archivo seleccionado');
                const file = e.target.files[0];
                if (!file) return;

                if (!file.type.startsWith('image/')) {
                    alert('Selecciona una imagen v√°lida');
                    return;
                }

                if (file.size > 5 * 1024 * 1024) {
                    alert('Imagen muy grande. M√°ximo 5MB');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.getElementById('photoCanvas');
                        const ctx = canvas.getContext('2d');
                        const size = 300;
                        canvas.width = size;
                        canvas.height = size;

                        const minDim = Math.min(img.width, img.height);
                        const sx = (img.width - minDim) / 2;
                        const sy = (img.height - minDim) / 2;

                        ctx.clearRect(0, 0, size, size);
                        ctx.beginPath();
                        ctx.arc(size / 2, size / 2, size / 2, 0, Math.PI * 2);
                        ctx.closePath();
                        ctx.clip();
                        ctx.drawImage(img, sx, sy, minDim, minDim, 0, 0, size, size);

                        canvas.toBlob(function(blob) {
                            window.photoBlob = blob;
                            const url = URL.createObjectURL(blob);
                            const preview = document.getElementById('photoPreview');
                            preview.style.backgroundImage = `url(${url})`;
                            preview.style.backgroundSize = 'cover';
                            preview.style.backgroundPosition = 'center';
                            preview.innerHTML = '';
                            console.log('‚úÖ Imagen procesada');
                        }, 'image/jpeg', 0.9);
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            });
            console.log('‚úÖ Input de foto configurado');
        }

        // ========================================================================
        // PROTECCI√ìN ANTI-RELOAD DURANTE GUARDADO DE FOTO
        // ========================================================================
        let guardandoFoto = false;

        window.addEventListener('beforeunload', function(e) {
            if (guardandoFoto) {
                e.preventDefault();
                e.returnValue = '';
                return '';
            }
        });

        // ========================================================================
        // INTERCEPTOR GLOBAL - SOLUCI√ìN AL RESETEO
        // ========================================================================
        // PROBLEMA: Al guardar foto, la p√°gina se reseteaba completamente
        // CAUSA: C√≥digo duplicado + event listeners m√∫ltiples
        // SOLUCI√ìN: UN SOLO handler con capture phase, sin duplicaci√≥n
        // ========================================================================

        // Funci√≥n centralizada para guardar foto
        function guardarFotoJugador() {
            console.log('üî• [GUARDAR FOTO] INICIO');
            guardandoFoto = true;

            if (!window.photoBlob) {
                alert('Selecciona una imagen primero');
                return;
            }

            const token = localStorage.getItem('token');
            if (!token) {
                alert('Debes iniciar sesi√≥n');
                return;
            }

            const formData = new FormData();
            formData.append('photo', window.photoBlob, 'player-photo.jpg');

            fetch('http://localhost:3000/api/upload/player-photo', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                })
                .then(response => {
                    console.log('üì• [GUARDAR FOTO] Respuesta recibida:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('‚úÖ [GUARDAR FOTO] Data:', data);
                    console.log('üìã Team actual:', window.photoTeam);
                    console.log('üìã Player ID:', window.photoPlayerId);

                    if (data.imageUrl) {
                        let photoCell = null;

                        // Buscar en las tablas del modal de edici√≥n
                        const modalRosterSelector = `#modal-roster-table tr[data-player-id="${window.photoPlayerId}"] .player-photo`;
                        const modalBenchSelector = `#modal-bench-table tr[data-player-id="${window.photoPlayerId}"] .player-photo`;

                        photoCell = document.querySelector(modalRosterSelector);
                        if (!photoCell) {
                            photoCell = document.querySelector(modalBenchSelector);
                        }

                        // Si no est√° en modal, buscar en las tablas principales
                        if (!photoCell) {
                            const rosterSelector = `#roster-${window.photoTeam} tr[data-player-id="${window.photoPlayerId}"] .player-photo`;
                            const benchSelector = `#bench-table-${window.photoTeam} tr[data-player-id="${window.photoPlayerId}"] .player-photo`;

                            photoCell = document.querySelector(rosterSelector);
                            if (!photoCell) {
                                photoCell = document.querySelector(benchSelector);
                            }
                        }

                        if (photoCell) {
                            photoCell.innerHTML = `<img src="http://localhost:3000${data.imageUrl}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">`;
                            photoCell.dataset.photoUrl = data.imageUrl;
                            console.log('‚úÖ [GUARDAR FOTO] Foto actualizada en tabla');
                        } else {
                            console.error('‚ùå [GUARDAR FOTO] No se encontr√≥ celda para jugador:', window.photoPlayerId, 'equipo:', window.photoTeam);
                        }

                        guardandoFoto = false;
                        window.closePhotoModal();
                        console.log('üéâ [GUARDAR FOTO] COMPLETADO SIN ERRORES');
                    }
                })
                .catch(err => {
                    console.error('‚ùå [GUARDAR FOTO] Error:', err);
                    guardandoFoto = false;
                    alert('Error al guardar la foto');
                });
        }

        // Interceptor global √∫nico - SOLO captura clicks cuando el modal est√° abierto
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('playerPhotoModal');
            if (!modal || modal.style.display === 'none') return; // Modal cerrado, dejar pasar eventos

            // Si el click es dentro del contenedor blanco del modal, procesar
            const modalContent = modal.querySelector('div[style*="background: white"]');
            if (!modalContent) return;

            // Si el click est√° FUERA del modal, bloquearlo completamente
            if (!modalContent.contains(e.target) && !modal.contains(e.target)) {
                console.log('üõë Click FUERA del modal - BLOQUEADO');
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                return false;
            }

            // Procesar botones del modal
            if (e.target.id === 'btn-guardar-foto') {
                console.log('üíæ Click en GUARDAR detectado');
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                guardarFotoJugador();
                return false;
            }

            if (e.target.id === 'btn-examinar-foto') {
                console.log('üìÅ Click en EXAMINAR detectado');
                e.preventDefault();
                e.stopPropagation();
                document.getElementById('playerPhotoInput').click();
                return false;
            }

            if (e.target.id === 'btn-cancelar-foto') {
                console.log('‚ùå Click en CANCELAR detectado');
                e.preventDefault();
                e.stopPropagation();
                window.closePhotoModal();
                return false;
            }
        }, true); // Fase de captura para interceptar ANTES que cualquier otro handler

        // BLOQUEAR el bot√≥n "Iniciar Nuevo Juego" cuando el modal est√© abierto
        const startGameBtn = document.getElementById('start-game-btn');
        if (startGameBtn) {
            startGameBtn.addEventListener('click', function(e) {
                const modal = document.getElementById('playerPhotoModal');
                if (modal && modal.style.display === 'flex') {
                    console.log('üö´ BLOQUEADO: Intento de iniciar juego con modal abierto');
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    return false;
                }
            }, true);
        }

        console.log('‚úÖ SISTEMA DE FOTOS LISTO');
    </script>
</body>

</html>